<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éœ€æ±‚åƒ¹æ ¼å½ˆæ€§äº’å‹•æ•™å­¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div class="container mx-auto p-4 max-w-6xl">
        <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
        <div class="flex justify-end mb-4">
            <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-1 flex">
                <button id="langZh" class="lang-btn px-3 py-1 rounded text-sm font-medium bg-primary text-white">
                    ä¸­æ–‡
                </button>
                <button id="langEn" class="lang-btn px-3 py-1 rounded text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    English
                </button>
            </div>
        </div>
        
        <div class="text-center mb-6">
            <h1 id="mainTitle" class="text-3xl font-bold mb-2">éœ€æ±‚åƒ¹æ ¼å½ˆæ€§äº’å‹•æ•™å­¸</h1>
        </div>

        <div class="grid lg:grid-cols-5 gap-6">
            <!-- æƒ…å¢ƒé¸æ“‡ - ç§»åˆ°å·¦æ–¹ -->
            <div class="lg:col-span-1">
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                    <div class="space-y-4">
                        <div>
                            <label id="task1Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™1</span>ï¼š<span class="text-red-600 dark:text-red-400">å¾é‡ç¨…</span></label>
                            <div class="grid grid-cols-1 gap-2">
                                <button id="unitTax" class="tax-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="unitTaxText">å¾é‡ç¨…</span>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label id="task2Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™2</span>ï¼š<span class="text-red-600 dark:text-red-400">éœ€æ±‚å½ˆæ€§é¡å‹</span></label>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="highElastic" class="elasticity-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="highElasticText">é«˜å½ˆæ€§</span>
                                </button>
                                <button id="lowElastic" class="elasticity-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="lowElasticText">ä½å½ˆæ€§</span>
                                </button>
                            </div>

                        </div>

                        <div>
                            <label id="task3Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™3</span>ï¼š<span class="text-red-600 dark:text-red-400">æ‹–æ‹½åˆ°åœ–è¡¨</span></label>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="benefit" class="benefit-btn px-3 py-2 rounded border-2 border-green-500 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 hover:border-green-600 transition-colors text-base cursor-move select-none" draggable="true">
                                    <span id="benefitText">å¾—ç›Š</span>
                                </button>
                                <button id="loss" class="benefit-btn px-3 py-2 rounded border-2 border-red-500 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 hover:border-red-600 transition-colors text-base cursor-move select-none" draggable="true">
                                    <span id="lossText">æå¤±</span>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label id="task4Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™4</span>ï¼š<span class="text-red-600 dark:text-red-400">æ‹–æ‹½åˆ°åœ–è¡¨</span></label>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="lessThan" class="comparison-btn px-3 py-2 rounded border-2 border-blue-500 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 hover:border-blue-600 transition-colors text-base cursor-move select-none text-xl font-bold" draggable="true">
                                    &lt;
                                </button>
                                <button id="greaterThan" class="comparison-btn px-3 py-2 rounded border-2 border-purple-500 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 hover:border-purple-600 transition-colors text-base cursor-move select-none text-xl font-bold" draggable="true">
                                    &gt;
                                </button>
                            </div>
                        </div>

                        <div>
                            <label id="task5Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™5</span>ï¼š<span class="text-red-600 dark:text-red-400">æäº¤</span></label>
                            <button id="submitBtn" class="w-full bg-red-600 text-white px-3 py-2 rounded border-2 border-red-600 hover:bg-red-700 transition-colors text-base disabled:opacity-50 disabled:cursor-not-allowed">
                                <span id="submitBtnText">æäº¤ç­”æ¡ˆ</span>
                            </button>
                            <div id="submitFeedback" class="hidden mt-2 p-3 rounded-lg text-sm font-medium"></div>
                        </div>

                        <div>
                            <label id="resetLabel" class="block text-sm font-medium mb-2"><span class="text-blue-600 dark:text-blue-400">é‡æ–°é–‹å§‹</span></label>
                            <button id="resetBtn" class="w-full bg-gray-600 text-white px-3 py-2 rounded border-2 border-gray-600 hover:bg-gray-700 transition-colors text-base">
                                <span id="resetBtnText">é‡æ–°æ•´ç†</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åœ–è¡¨å€åŸŸ -->
            <div class="lg:col-span-4">
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                    <canvas id="economicChart" width="600" height="400" class="w-full h-auto border border-gray-300 dark:border-gray-600 rounded"></canvas>
                </div>
                
                <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
                <div id="resultsPanel" class="hidden bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mt-4">
                    <h3 class="text-lg font-semibold mb-4">åˆ†æçµæœ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded">
                            <div class="font-medium">åƒ¹æ ¼è®ŠåŒ–</div>
                            <div id="priceChange" class="text-lg font-bold text-blue-600 dark:text-blue-400">--</div>
                        </div>
                        <div class="bg-green-100 dark:bg-green-900 p-3 rounded">
                            <div class="font-medium">éœ€æ±‚é‡è®ŠåŒ–</div>
                            <div id="quantityChange" class="text-lg font-bold text-green-600 dark:text-green-400">--</div>
                        </div>
                        <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded">
                            <div class="font-medium">æ”¶å…¥è®ŠåŒ–</div>
                            <div id="revenueChange" class="text-lg font-bold text-purple-600 dark:text-purple-400">--</div>
                        </div>
                    </div>
                    <div id="explanation" class="mt-4 p-3 bg-yellow-100 dark:bg-yellow-900 rounded text-sm"></div>
                </div>
            </div>

        </div>

        <!-- ç·´ç¿’é¡Œå€åŸŸ -->
        <div class="mt-8">
            <div id="quizSection" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-6 text-center">éœ€æ±‚åƒ¹æ ¼å½ˆæ€§ç·´ç¿’é¡Œ</h2>
                
                <!-- ç·´ç¿’é¡Œè§£é–æç¤º -->
                <div id="quizLockMessage" class="mb-6 p-4 bg-yellow-100 dark:bg-yellow-900 rounded-lg border-l-4 border-yellow-500">
                    <h3 class="text-lg font-semibold mb-2 text-yellow-800 dark:text-yellow-200">ğŸ”’ ç·´ç¿’é¡Œå°šæœªè§£é–</h3>
                    <div class="text-yellow-700 dark:text-yellow-300">
                        <p class="mb-2">è«‹å…ˆå®Œæˆä»¥ä¸‹ä»»å‹™æ‰èƒ½é–‹å§‹ç·´ç¿’é¡Œï¼š</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="bg-yellow-50 dark:bg-yellow-800 p-3 rounded">
                                <div class="font-medium">ä»»å‹™çµ„åˆ1ï¼šé«˜å½ˆæ€§æƒ…å¢ƒ</div>
                                <div id="highElasticProgress" class="mt-1 text-xs">
                                    âŒ å°šæœªå®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                                </div>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-800 p-3 rounded">
                                <div class="font-medium">ä»»å‹™çµ„åˆ2ï¼šä½å½ˆæ€§æƒ…å¢ƒ</div>
                                <div id="lowElasticProgress" class="mt-1 text-xs">
                                    âŒ å°šæœªå®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                                </div>
                            </div>
                        </div>
                        <p class="mt-3 text-xs">ğŸ’¡ æç¤ºï¼šæ¯ç¨®å½ˆæ€§é¡å‹éƒ½éœ€è¦å®Œæˆä»»å‹™1-5çš„å®Œæ•´æµç¨‹ï¼ˆé¸æ“‡å¾é‡ç¨…â†’é¸æ“‡å½ˆæ€§é¡å‹â†’æ‹–æ‹½éœ€æ±‚ç·šâ†’æ‹–æ‹½å¾—ç›Š/æå¤±â†’æ‹–æ‹½æ¯”è¼ƒç¬¦è™Ÿâ†’æäº¤ç­”æ¡ˆï¼‰</p>
                    </div>
                </div>
                
                <!-- é¡Œç›®1 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-blue-500">
                    <h3 class="text-lg font-semibold mb-3">é¡Œç›®1ï¼šå¾é‡ç¨…åŸºæœ¬æ•ˆæœ</h3>
                    <p class="mb-4">æ”¿åºœå°æŸå•†å“èª²å¾µå¾é‡ç¨…å¾Œï¼Œæœƒå°è‡´ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q1" value="price_up_quantity_down" class="text-primary focus:ring-primary">
                            <span>å¸‚å ´åƒ¹æ ¼ä¸Šå‡ï¼Œäº¤æ˜“æ•¸é‡ä¸‹é™</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q1" value="price_down_quantity_up" class="text-primary focus:ring-primary">
                            <span>å¸‚å ´åƒ¹æ ¼ä¸‹é™ï¼Œäº¤æ˜“æ•¸é‡ä¸Šå‡</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q1" value="no_change" class="text-primary focus:ring-primary">
                            <span>å¸‚å ´åƒ¹æ ¼å’Œæ•¸é‡éƒ½ä¸è®Š</span>
                        </label>
                    </div>
                    <div id="feedback1" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®2 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-green-500">
                    <h3 class="text-lg font-semibold mb-3">é¡Œç›®2ï¼šéœ€æ±‚å½ˆæ€§èˆ‡ç”Ÿç”¢è€…æ”¶å…¥</h3>
                    <p class="mb-4">ç•¶å•†å“éœ€æ±‚ç‚º<strong>é«˜å½ˆæ€§</strong>æ™‚ï¼Œç”Ÿç”¢è€…ç¸½æ”¶å…¥æœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q2" value="producer_revenue_increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q2" value="producer_revenue_decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q2" value="producer_revenue_unchanged" class="text-primary focus:ring-primary">
                            <span>ä¸è®Š</span>
                        </label>
                    </div>
                    <div id="feedback2" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®3 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-purple-500">
                    <h3 class="text-lg font-semibold mb-3">é¡Œç›®3ï¼šä¾›çµ¦ç·šç§»å‹•å¹…åº¦</h3>
                    <p class="mb-4">ç•¶æ”¿åºœå¯¦æ–½å¾é‡ç¨…å¾Œï¼Œå…©æ¢ä¾›çµ¦ç·šï¼ˆS1å’ŒS2ï¼‰ä¹‹é–“çš„å‚ç›´è·é›¢ç­‰æ–¼ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q3" value="tax_amount" class="text-primary focus:ring-primary">
                            <span>å¾é‡ç¨…çš„ç¨…é¡</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q3" value="price_change" class="text-primary focus:ring-primary">
                            <span>å¸‚å ´åƒ¹æ ¼çš„è®ŠåŒ–é‡</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q3" value="quantity_change" class="text-primary focus:ring-primary">
                            <span>å‡è¡¡æ•¸é‡çš„è®ŠåŒ–é‡</span>
                        </label>
                    </div>
                    <div id="feedback3" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®4 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-orange-500">
                    <h3 class="text-lg font-semibold mb-3">é¡Œç›®4ï¼šæ¶ˆè²»è€…ç¸½æ”¯å‡º</h3>
                    <p class="mb-4">ç•¶æ”¿åºœå¯¦æ–½å¾é‡ç¨…å¾Œï¼Œæ¶ˆè²»è€…ç¸½æ”¯å‡ºæœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q4" value="consumer_spending_increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q4" value="consumer_spending_decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q4" value="depends_on_elasticity" class="text-primary focus:ring-primary">
                            <span>å–æ±ºæ–¼éœ€æ±‚å½ˆæ€§</span>
                        </label>
                    </div>
                    <div id="feedback4" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®5 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-red-500">
                    <h3 class="text-lg font-semibold mb-3">é¡Œç›®5ï¼šå®Œå…¨ç„¡å½ˆæ€§éœ€æ±‚</h3>
                    <p class="mb-4">ç•¶æ”¿åºœå‘ç‰©å“Xå¯¦æ–½å¾é‡ç¨…ï¼Œå¦‚æœæ¶ˆè²»è€…å°å®ƒçš„éœ€æ±‚æ˜¯<strong>å®Œå…¨ç„¡å½ˆæ€§</strong>ï¼Œäº¤æ˜“é‡æœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q5" value="quantity_increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q5" value="quantity_decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q5" value="quantity_unchanged" class="text-primary focus:ring-primary">
                            <span>ä¸è®Š</span>
                        </label>
                    </div>
                    <div id="feedback5" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- ç¸½åˆ†é¡¯ç¤º -->
                <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900 rounded-lg text-center">
                    <div id="totalScore" class="text-lg font-semibold text-blue-800 dark:text-blue-200">
                        å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå°‡é¡¯ç¤ºç¸½åˆ†
                    </div>
                    <button id="resetQuiz" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
                        é‡æ–°ä½œç­”
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ·±è‰²æ¨¡å¼æ”¯æ´
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        class ElasticitySimulator {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // åœ–è¡¨åƒæ•¸
                this.margin = { top: 40, right: 40, bottom: 60, left: 60 };
                this.chartWidth = this.width - this.margin.left - this.margin.right;
                this.chartHeight = this.height - this.margin.top - this.margin.bottom;
                
                // ç‹€æ…‹
                this.selectedUnitTax = false; // æ˜¯å¦é¸æ“‡å¾é‡ç¨…
                this.selectedElasticity = null; // 'high' or 'low'
                this.selectedBenefit = null; // 'benefit' or 'loss'
                this.prediction = null; // 'up', 'same', 'down'
                this.isDragging = false;
                this.dragPoint = null;
                this.hasModifiedDemandLine = false; // è·Ÿè¸ªæ˜¯å¦å·²ä¿®æ”¹éœ€æ±‚ç·š
                
                // å®Œæˆè¿½è¸ªç‹€æ…‹
                this.completedTasks = {
                    high: false,  // æ˜¯å¦å®Œæˆéé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                    low: false    // æ˜¯å¦å®Œæˆéä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                };
                
                // æç¤ºæ¡†ç‹€æ…‹
                this.showHint = false;
                this.hintOpacity = 1;
                this.hintInterval = null;
                
                // ç¶“æ¿Ÿåƒæ•¸
                this.basePrice = 50;
                this.baseQuantity = 40;
                this.priceChangePercent = 0.2; // 20%
                this.demandSlope = -1.0; // åˆå§‹45åº¦éœ€æ±‚ç·šæ–œç‡
                this.demandIntercept = 90; // éœ€æ±‚ç·šæˆªè·
                
                // ä¾›çµ¦ç·šåƒæ•¸
                this.supplySlope = 1.0; // æ­£æ–œç‡ï¼Œå‘ä¸Šå‚¾æ–œ
                this.supplyIntercept = 10; // ä¾›çµ¦ç·šæˆªè·ï¼ˆS1ï¼‰
                this.originalSupplyIntercept = 10; // ä¿å­˜åŸå§‹ä¾›çµ¦ç·šæˆªè·
                this.unitTaxAmount = 20; // å¾é‡ç¨…ç¨…é¡
                
                // å‡è¡¡é»åƒæ•¸
                this.equilibriumP1 = null; // åŸå§‹å‡è¡¡åƒ¹æ ¼
                this.equilibriumQ1 = null; // åŸå§‹å‡è¡¡æ•¸é‡
                this.equilibriumP2 = null; // æ–°å‡è¡¡åƒ¹æ ¼ï¼ˆåŠ ç¨…å¾Œï¼‰
                this.equilibriumQ2 = null; // æ–°å‡è¡¡æ•¸é‡ï¼ˆåŠ ç¨…å¾Œï¼‰
                
                this.scenarios = {
                    high: { elasticity: -2.0, demandSlope: -0.8 }, // é«˜å½ˆæ€§
                    low: { elasticity: -0.4, demandSlope: -3.0 }   // ä½å½ˆæ€§
                };
                
                // æ‹–æ‹½ç‹€æ…‹
                this.isDraggedToCanvas = false;
                this.draggedType = null;
                this.draggedPositions = {}; // å­˜å„²å¤šå€‹æ‹–æ‹½ä½ç½® {benefit: {x, y}, loss: {x, y}}
                
                // ä»»å‹™4ç‹€æ…‹
                this.selectedComparison = null; // '<' or '>'
                this.isComparisonDraggedToCanvas = false;
                
                this.init();
            }
            
            init() {
                this.drawChart();
                this.setupEventListeners();
                this.setupCanvasEvents();
                this.setupDragAndDrop();
                this.updateSimulateButton();
                this.updateElasticityDisplay();
                this.updateTaskAvailability(); // åˆå§‹åŒ–ä»»åŠ¡å¯ç”¨æ€§
            }
            
            setupEventListeners() {
                // å¾é‡ç¨…æŒ‰éˆ•
                document.getElementById('unitTax').addEventListener('click', () => {
                    this.selectUnitTax();
                });
                
                // å½ˆæ€§é¸æ“‡æŒ‰éˆ•
                document.getElementById('highElastic').addEventListener('click', () => {
                    this.selectElasticity('high');
                });
                
                document.getElementById('lowElastic').addEventListener('click', () => {
                    this.selectElasticity('low');
                });
                
                // æäº¤æŒ‰éˆ•
                document.getElementById('submitBtn').addEventListener('click', () => {
                    this.submitAnswer();
                });
                
                // é‡æ–°æ•´ç†æŒ‰éˆ•
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.resetAll();
                });
            }
            
            setupDragAndDrop() {
                // æ‹–æ‹½äº‹ä»¶ç›£è½å™¨
                document.getElementById('benefit').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'benefit');
                });
                
                document.getElementById('loss').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'loss');
                });
                
                // ä»»å‹™4æ¯”è¼ƒç¬¦è™Ÿæ‹–æ‹½
                document.getElementById('lessThan').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'lessThan');
                });
                
                document.getElementById('greaterThan').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'greaterThan');
                });
                
                // Canvasä½œç‚ºæ‹–æ‹½ç›®æ¨™
                this.canvas.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.canvas.style.cursor = 'copy';
                });
                
                this.canvas.addEventListener('dragleave', (e) => {
                    this.canvas.style.cursor = 'default';
                });
                
                this.canvas.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.canvas.style.cursor = 'default';
                    this.handleDrop(e);
                });
            }
            
            handleDragStart(e, type) {
                this.draggedType = type;
                // è¨­ç½®æ‹–æ‹½æ•¸æ“š
                e.dataTransfer.setData('text/plain', type);
                e.dataTransfer.effectAllowed = 'copy';
                
                // æ·»åŠ æ‹–æ‹½æ™‚çš„è¦–è¦ºæ•ˆæœ
                setTimeout(() => {
                    e.target.style.opacity = '0.5';
                }, 0);
            }
            
            handleDrop(e) {
                const draggedType = e.dataTransfer.getData('text/plain');
                
                // æ¢å¾©æ‹–æ‹½å…ƒç´ çš„é€æ˜åº¦
                const draggedElement = document.getElementById(draggedType);
                draggedElement.style.opacity = '1';
                
                // ç²å–æ‹–æ‹½ä½ç½®
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                const canvasX = (e.clientX - rect.left) * scaleX;
                const canvasY = (e.clientY - rect.top) * scaleY;
                
                // ä»»å‹™4ï¼šæ¯”è¼ƒç¬¦è™Ÿæ‹–æ‹½è™•ç†
                if (draggedType === 'lessThan' || draggedType === 'greaterThan') {
                    // æª¢æŸ¥æ˜¯å¦æ”¾åœ¨æ¯”è¼ƒæ¡†å€åŸŸ
                    const comparisonZone = this.getComparisonDropZone(canvasX, canvasY);
                    
                    if (comparisonZone) {
                        // æˆåŠŸæ”¾ç½®åœ¨æ¯”è¼ƒæ¡†ä¸­
                        this.selectedComparison = draggedType === 'lessThan' ? '<' : '>';
                        this.isComparisonDraggedToCanvas = true;
                        
                        // æ›´æ–°ä»»å‹™å¯ç”¨æ€§
                        this.updateTaskAvailability();
                        
                        // é‡æ–°ç¹ªè£½åœ–è¡¨ä»¥é¡¯ç¤ºæ¯”è¼ƒç¬¦è™Ÿ
                        this.drawChart();
                        
                        // æä¾›æ”¾ç½®ç¢ºèªåé¥‹
                        this.showComparisonDropConfirmation(this.selectedComparison);
                    } else {
                        // æ”¾éŒ¯åœ°æ–¹
                        this.showComparisonDropError();
                    }
                    return;
                }
                
                // ä»»å‹™3ï¼šå¾—ç›Š/æå¤±æ‹–æ‹½è™•ç†ï¼ˆåŸæœ‰é‚è¼¯ï¼‰
                if (draggedType === 'benefit' || draggedType === 'loss') {
                    // æª¢æŸ¥æ˜¯å¦æ”¾åœ¨P1-P2æˆ–Q1-Q2å€åŸŸ
                    const dropZone = this.getDropZone(canvasX, canvasY);
                    
                    if (dropZone) {
                        // æˆåŠŸæ”¾ç½®åœ¨æœ‰æ•ˆå€åŸŸï¼ˆå…è¨±æ”¾ç½®åœ¨ä»»ä½•å€åŸŸï¼ŒåŒ…æ‹¬éŒ¯èª¤çš„ï¼‰
                        this.selectedBenefit = draggedType;
                        this.isDraggedToCanvas = true;
                        
                        // è¨˜éŒ„å­¸ç”Ÿå¯¦éš›é¸æ“‡çš„å€åŸŸ
                        this.studentDropZone = dropZone;
                        
                        // æ›´æ–°è¦–è¦ºåé¥‹
                        this.updateDraggedVisualization(canvasX, canvasY, draggedType, dropZone);
                        
                        // æ›´æ–°ä»»å‹™å¯ç”¨æ€§
                        this.updateTaskAvailability();
                        
                        // æä¾›æ”¾ç½®ç¢ºèªåé¥‹ï¼ˆä¸é¡¯ç¤ºå°éŒ¯ï¼‰
                        this.showDropConfirmation(draggedType, dropZone);
                    } else {
                        // å®Œå…¨æ”¾éŒ¯åœ°æ–¹ï¼ˆä¸åœ¨ä»»ä½•æŒ‡å®šå€åŸŸï¼‰
                        this.showDropError();
                    }
                }
            }
            
            getDropZone(canvasX, canvasY) {
                // ä»é‡ç¨æƒ…å†µä¸‹ï¼Œä½¿ç”¨å®é™…å‡è¡¡ç‚¹åæ ‡
                if (!this.selectedUnitTax || !this.equilibriumP1 || !this.equilibriumQ1 || !this.equilibriumP2 || !this.equilibriumQ2) return null;
                
                // P1-P2å€åŸŸï¼ˆåƒ¹æ ¼è®ŠåŒ–å€åŸŸ - Yè»¸å·¦å´çš„æ°´å¹³å€åŸŸï¼‰
                const p1p2ZoneX1 = this.margin.left + 10;
                const p1p2ZoneX2 = Math.max(
                    this.toCanvasX(Math.min(this.equilibriumQ1, this.equilibriumQ2)) - 10,
                    p1p2ZoneX1 + 80  // ç¢ºä¿æœ€å°å¯¬åº¦80px
                );
                const p1p2ZoneY1 = Math.min(this.toCanvasY(this.equilibriumP1), this.toCanvasY(this.equilibriumP2)) - 15;
                const p1p2ZoneY2 = Math.max(
                    Math.max(this.toCanvasY(this.equilibriumP1), this.toCanvasY(this.equilibriumP2)) + 15,
                    p1p2ZoneY1 + 40  // ç¢ºä¿æœ€å°é«˜åº¦40px
                );
                
                // Q1-Q2å€åŸŸï¼ˆæ•¸é‡è®ŠåŒ–å€åŸŸ - Q1å’ŒQ2å‚ç›´è™›ç·šä¹‹é–“çš„çŸ©å½¢å€åŸŸï¼‰
                const q1q2BaseX1 = Math.min(this.toCanvasX(this.equilibriumQ1), this.toCanvasX(this.equilibriumQ2));
                const q1q2BaseX2 = Math.max(this.toCanvasX(this.equilibriumQ1), this.toCanvasX(this.equilibriumQ2));
                
                // ç¢ºä¿Q1-Q2å€åŸŸæœ‰æœ€å°å¯¬åº¦
                const q1q2MinWidth = 60; // æœ€å°å¯¬åº¦60px
                const q1q2ActualWidth = q1q2BaseX2 - q1q2BaseX1;
                
                let q1q2ZoneX1, q1q2ZoneX2;
                if (q1q2ActualWidth < q1q2MinWidth) {
                    // å¦‚æœå¯¦éš›å¯¬åº¦å¤ªå°ï¼Œä»¥Q1ç‚ºä¸­å¿ƒæ“´å±•
                    const centerX = this.toCanvasX(this.equilibriumQ1);
                    q1q2ZoneX1 = centerX - q1q2MinWidth / 2;
                    q1q2ZoneX2 = centerX + q1q2MinWidth / 2;
                } else {
                    q1q2ZoneX1 = q1q2BaseX1 + 5;
                    q1q2ZoneX2 = q1q2BaseX2 - 5;
                }
                
                const q1q2ZoneY1 = this.toCanvasY(Math.max(this.equilibriumP1, this.equilibriumP2)) + 10; // å¾è¼ƒé«˜åƒ¹æ ¼ç·šä¸‹æ–¹é–‹å§‹
                const q1q2ZoneY2 = this.height - this.margin.bottom - 10; // åˆ°Xè»¸ä¸Šæ–¹çµæŸ
                
                // æª¢æŸ¥æ˜¯å¦åœ¨P1-P2å€åŸŸ
                if (canvasX >= p1p2ZoneX1 && canvasX <= p1p2ZoneX2 && 
                    canvasY >= p1p2ZoneY1 && canvasY <= p1p2ZoneY2) {
                    return 'P1P2';
                }
                
                // æª¢æŸ¥æ˜¯å¦åœ¨Q1-Q2å€åŸŸï¼ˆç¢ºä¿æœ‰æœ€å°å¯¬åº¦ï¼‰
                if (q1q2ZoneX2 > q1q2ZoneX1 && // ç¢ºä¿æœ‰å¯¬åº¦
                    canvasX >= q1q2ZoneX1 && canvasX <= q1q2ZoneX2 && 
                    canvasY >= q1q2ZoneY1 && canvasY <= q1q2ZoneY2) {
                    return 'Q1Q2';
                }
                
                return null;
            }
            
            updateDraggedVisualization(x, y, type, dropZone) {
                // å„²å­˜æ‹–æ‹½ä½ç½®ã€é¡å‹å’Œå­¸ç”Ÿå¯¦éš›é¸æ“‡çš„å€åŸŸ
                this.draggedPositions[type] = { x, y, zone: dropZone };
                
                // é‡æ–°ç¹ªè£½åœ–è¡¨ï¼ˆæœƒè‡ªå‹•åŒ…å«æ‰€æœ‰æ‹–æ‹½æ¨™ç±¤ï¼‰
                this.drawChart();
            }
            
            drawDraggedLabels() {
                // ç¹ªè£½æ‰€æœ‰å·²æ‹–æ‹½çš„æ¨™ç±¤
                for (const [type, position] of Object.entries(this.draggedPositions)) {
                    if (position) {
                        this.drawSingleDraggedLabel(position.x, position.y, type);
                    }
                }
            }
            
            drawSingleDraggedLabel(x, y, type) {
                // ç§»é™¤å¯¹ä»·æ ¼å˜åŒ–çš„ä¾èµ–ï¼Œè®©æ ‡ç­¾ç«‹å³æ˜¾ç¤º
                this.ctx.save();
                
                // è¨ˆç®—å°æ‡‰å€åŸŸçš„ç²¾ç¢ºä½ç½®å’Œå°ºå¯¸
                const areaInfo = this.calculateAreaPosition(type);
                if (!areaInfo) {
                    this.ctx.restore();
                    return;
                }
                
                // ç¹ªè£½ç­”æ¡ˆæ¨™ç±¤ - æ ¹æ®è¯­è¨€æ˜¾ç¤º
                const text = type === 'benefit' ? 
                    (languageManager.currentLang === 'en' ? languageManager.getText('gainText') : 'å¾—ç›Š') :
                    (languageManager.currentLang === 'en' ? languageManager.getText('lossText') : 'æå¤±');
                const bgColor = type === 'benefit' ? '#10B981' : '#EF4444';
                const textColor = '#FFFFFF';
                
                // ä½¿ç”¨ç²¾ç¢ºè¨ˆç®—çš„ä½ç½®å’Œå°ºå¯¸
                const rectX = areaInfo.x;
                const rectY = areaInfo.y;
                const rectWidth = areaInfo.width;
                const rectHeight = areaInfo.height;
                
                // ç¹ªè£½èƒŒæ™¯çŸ©å½¢ï¼ˆç²¾ç¢ºè¦†è“‹è™›ç·šå€åŸŸï¼‰
                this.ctx.fillStyle = bgColor;
                this.ctx.globalAlpha = 0.7; // åŠé€æ˜æ•ˆæœ
                
                this.ctx.beginPath();
                this.roundRect(rectX, rectY, rectWidth, rectHeight, 6);
                this.ctx.fill();
                
                // ç¹ªè£½é‚Šæ¡†
                this.ctx.globalAlpha = 1;
                this.ctx.strokeStyle = bgColor;
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // ç¹ªè£½æ–‡å­—ï¼ˆåœ¨çŸ©å½¢ä¸­å¿ƒï¼‰
                this.ctx.fillStyle = textColor;
                this.ctx.globalAlpha = 1;
                
                // æ ¹æ“šçŸ©å½¢å¤§å°èª¿æ•´å­—é«”
                const fontSize = Math.min(rectWidth / 6, rectHeight / 3, 16);
                this.ctx.font = `bold ${fontSize}px sans-serif`;
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                // æ–‡å­—ä½ç½®åœ¨çŸ©å½¢ä¸­å¿ƒ
                const textX = rectX + rectWidth / 2;
                const textY = rectY + rectHeight / 2;
                this.ctx.fillText(text, textX, textY);
                
                this.ctx.restore();
            }
            
            calculateAreaPosition(type) {
                // ä»é‡ç¨æƒ…å†µä¸‹ï¼Œä½¿ç”¨å®é™…å‡è¡¡ç‚¹åæ ‡
                if (!this.selectedUnitTax || !this.equilibriumP1 || !this.equilibriumQ1 || !this.equilibriumP2 || !this.equilibriumQ2) {
                    // åœ¨Canvasä¸­å¿ƒé™„è¿‘æ˜¾ç¤ºä¸€ä¸ªç®€å•çš„æ ‡ç­¾
                    const centerX = this.width / 2;
                    const centerY = this.height / 2;
                    
                    return {
                        x: centerX - 40 + (type === 'benefit' ? -50 : 50), // å·¦å³åˆ†å¼€æ˜¾ç¤º
                        y: centerY - 20,
                        width: 80,
                        height: 40
                    };
                }
                
                // æ ¹æ“šå­¸ç”Ÿå¯¦éš›æ‹–æ‹½åˆ°çš„å€åŸŸä¾†ç¢ºå®šä½ç½®
                let targetZone = null;
                if (this.draggedPositions[type] && this.draggedPositions[type].zone) {
                    targetZone = this.draggedPositions[type].zone;
                } else {
                    // ä»é‡ç¨æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§åŠ ä»·é€»è¾‘å¤„ç†
                    targetZone = (type === 'benefit') ? 'P1P2' : 'Q1Q2';
                }
                
                if (targetZone === 'P1P2') {
                    // P1-P2å€åŸŸï¼šä½¿ç”¨å¯¦éš›å‡è¡¡é»åæ¨™
                    const p1p2X = this.margin.left;
                    const p1p2Y = Math.min(this.toCanvasY(this.equilibriumP1), this.toCanvasY(this.equilibriumP2));
                    const p1p2Width = this.toCanvasX(Math.min(this.equilibriumQ1, this.equilibriumQ2)) - this.margin.left;
                    const p1p2Height = Math.abs(this.toCanvasY(this.equilibriumP1) - this.toCanvasY(this.equilibriumP2));
                    
                    return {
                        x: p1p2X,
                        y: p1p2Y,
                        width: Math.max(p1p2Width, 40),
                        height: Math.max(p1p2Height, 20)
                    };
                } else {
                    // Q1-Q2å€åŸŸï¼šä½¿ç”¨å¯¦éš›å‡è¡¡é»åæ¨™
                    const q1q2X = Math.min(this.toCanvasX(this.equilibriumQ1), this.toCanvasX(this.equilibriumQ2));
                    const q1q2Width = Math.abs(this.toCanvasX(this.equilibriumQ1) - this.toCanvasX(this.equilibriumQ2));
                    
                    // å¦‚æœQ1-Q2è·é›¢å¤ªå°ï¼Œä¸å¼·åˆ¶ç¹ªè£½çŸ©å½¢
                    if (q1q2Width < 3) {
                        return null; // è·é›¢å¤ªå°æ™‚ä¸ç¹ªè£½
                    }
                    
                    // ç¢ºä¿çŸ©å½¢é¢ç©ç²¾ç¢ºç­‰æ–¼è™›ç·šé•·æ–¹å½¢ï¼šå¯¬åº¦ Ã— é«˜åº¦ = |Q1-Q2| Ã— åƒ¹æ ¼
                    let targetPrice, q1q2Y, q1q2HeightPixels;
                    
                    // ä»é‡ç¨åŠ ä»·æ—¶ï¼šé¢ç© = P1 Ã— |Q1-Q2|ï¼ˆä½¿ç”¨å¯¦éš›å‡è¡¡åƒ¹æ ¼ï¼‰
                    targetPrice = this.equilibriumP1; // ä½¿ç”¨å¯¦éš›E1åƒ¹æ ¼
                    q1q2HeightPixels = this.toCanvasY(0) - this.toCanvasY(targetPrice);
                    q1q2Y = this.toCanvasY(0) - q1q2HeightPixels;
                    
                    return {
                        x: q1q2X,
                        y: q1q2Y,
                        width: q1q2Width, // åš´æ ¼ä½¿ç”¨å¯¦éš›å¯¬åº¦ï¼Œä¸è¨­æœ€å°å€¼
                        height: q1q2HeightPixels // åš´æ ¼ä½¿ç”¨å¯¦éš›é«˜åº¦ï¼Œä¸è¨­æœ€å°å€¼
                    };
                }
            }
            
            showDropConfirmation(type, zone) {
                this.ctx.save();
                
                // æ ¹æ®è¯­è¨€æ˜¾ç¤ºæ–‡å­—
                const typeText = type === 'benefit' ? 
                    (languageManager.currentLang === 'en' ? languageManager.getText('gainText') : 'å¾—ç›Š') :
                    (languageManager.currentLang === 'en' ? languageManager.getText('lossText') : 'æå¤±');
                const zoneText = zone === 'P1P2' ? 
                    (languageManager.currentLang === 'en' ? languageManager.getText('p1p2Area') : 'P1-P2å€åŸŸ') :
                    (languageManager.currentLang === 'en' ? languageManager.getText('q1q2Area') : 'Q1-Q2å€åŸŸ');
                
                const message = languageManager.currentLang === 'en' ? 
                    `Placed: ${typeText} â†’ ${zoneText}` : 
                    `å·²æ”¾ç½®ï¼š${typeText} â†’ ${zoneText}`;
                const bgColor = '#3B82F6'; // è—è‰²ï¼Œè¡¨ç¤ºä¸­æ€§ç¢ºèª
                
                const boxX = this.width / 2 - 120;
                const boxY = 10;
                const boxWidth = 240;
                const boxHeight = 30;
                
                // èƒŒæ™¯
                this.ctx.fillStyle = bgColor;
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                // æ–‡å­—
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                // 2ç§’å¾Œæ¸…é™¤è¨Šæ¯
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            showDropError() {
                this.ctx.save();
                
                const message = languageManager.currentLang === 'en' ? 
                    languageManager.getText('dropError') : 'è«‹æ‹–æ‹½åˆ°P1-P2æˆ–Q1-Q2å€åŸŸ';
                const boxX = this.width / 2 - 100;
                const boxY = 10;
                const boxWidth = 200;
                const boxHeight = 30;
                
                // èƒŒæ™¯
                this.ctx.fillStyle = '#EF4444';
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                // æ–‡å­—
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 11px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                // 2ç§’å¾Œæ¸…é™¤è¨Šæ¯
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            setupCanvasEvents() {
                // é¼ æ¨™äº‹ä»¶
                this.canvas.addEventListener('mousedown', (e) => this.handleStart(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleMove(e));
                this.canvas.addEventListener('mouseup', (e) => this.handleEnd(e));
                this.canvas.addEventListener('mouseleave', (e) => this.handleEnd(e));
                
                // è§¸æ‘¸äº‹ä»¶
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.handleStart(e.touches[0]);
                });
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.handleMove(e.touches[0]);
                });
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.handleEnd(e);
                });
            }
            
            getEventPos(e) {
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }
            
            handleStart(e) {
                const pos = this.getEventPos(e);
                
                // æª¢æŸ¥æ˜¯å¦é»æ“Šåœ¨éœ€æ±‚ç·šé™„è¿‘
                if (this.isNearDemandLine(pos.x, pos.y)) {
                    this.isDragging = true;
                    this.dragPoint = pos;
                    this.canvas.style.cursor = 'grabbing';
                    
                    // é–‹å§‹æ‹–æ‹½æ™‚éš±è—æç¤ºæ¡†
                    this.hideHint();
                }
            }
            
            handleMove(e) {
                const pos = this.getEventPos(e);
                
                if (this.isDragging) {
                    // è¨ˆç®—æ–°çš„æ–œç‡
                    this.updateDemandSlope(pos);
                    this.drawChart();
                    this.updateElasticityDisplay();
                } else {
                    // æª¢æŸ¥æ˜¯å¦åœ¨éœ€æ±‚ç·šé™„è¿‘ï¼Œæ”¹è®Šæ¸¸æ¨™
                    if (this.isNearDemandLine(pos.x, pos.y)) {
                        this.canvas.style.cursor = 'grab';
                    } else {
                        this.canvas.style.cursor = 'default';
                    }
                }
            }
            
            handleEnd(e) {
                if (this.isDragging) {
                    // æ ‡è®°éœ€æ±‚çº¿å·²è¢«ä¿®æ”¹ï¼Œå¯ç”¨ä»»åŠ¡3
                    this.hasModifiedDemandLine = true;
                    this.updateTaskAvailability();
                }
                this.isDragging = false;
                this.dragPoint = null;
                this.canvas.style.cursor = 'default';
            }
            
            isNearDemandLine(canvasX, canvasY) {
                // è½‰æ›åˆ°ç¶“æ¿Ÿåº§æ¨™
                const economicX = ((canvasX - this.margin.left) / this.chartWidth) * 80;
                const economicY = ((this.height - this.margin.bottom - canvasY) / this.chartHeight) * 100;
                
                // å°æ–¼æ¥è¿‘æ°´å¹³çš„ç·šæ¢ï¼Œä½¿ç”¨ç‰¹æ®Šæª¢æ¸¬
                if (Math.abs(this.demandSlope) < 0.001) {
                    // æ°´å¹³ç·šæª¢æ¸¬ï¼šæª¢æŸ¥æ˜¯å¦æ¥è¿‘åŸºæº–é»çš„Yå€¼
                    const distance = Math.abs(economicY - this.basePrice);
                    return distance < 10 && economicX >= 0 && economicX <= 80;
                } else {
                    // æ­£å¸¸ç·šæ¢æª¢æ¸¬
                    const lineY = this.demandIntercept + this.demandSlope * economicX;
                    const distance = Math.abs(economicY - lineY);
                    
                    return distance < 10 && 
                           economicX >= 0 && economicX <= 80 && 
                           economicY >= 0 && economicY <= 100;
                }
            }
            
            updateDemandSlope(pos) {
                // è½‰æ›åˆ°ç¶“æ¿Ÿåº§æ¨™
                const economicX = ((pos.x - this.margin.left) / this.chartWidth) * 80;
                const economicY = ((this.height - this.margin.bottom - pos.y) / this.chartHeight) * 100;
                
                // è¨ˆç®—æ–°æ–œç‡ï¼ˆä¿æŒé€šéåŸºæº–é»ï¼‰
                if (Math.abs(economicX - this.baseQuantity) > 0.1) {
                    const newSlope = (economicY - this.basePrice) / (economicX - this.baseQuantity);
                    // é™åˆ¶æ–œç‡ç¯„åœï¼šå¾æ¥è¿‘æ°´å¹³(0åº¦)åˆ°æ¥è¿‘å‚ç›´(90åº¦)
                    this.demandSlope = Math.max(-1000, Math.min(-0.00001, newSlope));
                    
                    // ç‰¹æ®Šè™•ç†ï¼šå¦‚æœç”¨æˆ¶æ‹–æ‹½åˆ°æ¥è¿‘æ°´å¹³ä½ç½®ï¼ˆYå€¼è®ŠåŒ–å¾ˆå°ï¼‰
                    const yDiff = Math.abs(economicY - this.basePrice);
                    if (yDiff < 5) {
                        this.demandSlope = -0.00001; // å¼·åˆ¶è¨­ç‚ºæ¥è¿‘æ°´å¹³
                    }
                    
                    // é‡æ–°è¨ˆç®—æˆªè·
                    this.demandIntercept = this.basePrice - this.demandSlope * this.baseQuantity;
                    
                    // é‡è¦ï¼šå¦‚æœå·²é¸æ“‡å¾é‡ç¨…ï¼Œé‡æ–°è¨ˆç®—å‡è¡¡é»
                    if (this.selectedUnitTax) {
                        this.calculateOriginalEquilibrium();
                        this.calculateNewEquilibrium();
                    }
                }
            }
            
            selectUnitTax() {
                this.selectedUnitTax = true;
                this.updateButtonStates('.tax-btn', 0);
                
                // è¨ˆç®—åŸå§‹å‡è¡¡é»ï¼ˆS1èˆ‡Dçš„äº¤é»ï¼‰
                this.calculateOriginalEquilibrium();
                
                // å¾é‡ç¨…ä½¿ä¾›çµ¦ç·šå‘ä¸Šç§»å‹•ï¼ˆS1 â†’ S2ï¼‰
                this.supplyIntercept = this.originalSupplyIntercept + this.unitTaxAmount;
                
                // è¨ˆç®—æ–°å‡è¡¡é»ï¼ˆS2èˆ‡Dçš„äº¤é»ï¼‰
                this.calculateNewEquilibrium();
                
                this.updateTaskAvailability(); // æ›´æ–°ä»»åŠ¡å¯ç”¨æ€§
                this.drawChart(); // é‡æ–°ç¹ªè£½åœ–è¡¨é¡¯ç¤ºè®ŠåŒ–
            }
            
            calculateOriginalEquilibrium() {
                // è¨ˆç®—éœ€æ±‚ç·šå’ŒåŸå§‹ä¾›çµ¦ç·šçš„äº¤é»
                // éœ€æ±‚ç·š: P = demandIntercept + demandSlope * Q
                // ä¾›çµ¦ç·š: P = originalSupplyIntercept + supplySlope * Q
                // æ±‚äº¤é»: demandIntercept + demandSlope * Q = originalSupplyIntercept + supplySlope * Q
                
                const denominator = this.supplySlope - this.demandSlope;
                if (Math.abs(denominator) < 0.001) {
                    // ç·šæ¢å¹³è¡Œï¼Œä½¿ç”¨é è¨­å€¼
                    this.equilibriumQ1 = this.baseQuantity;
                    this.equilibriumP1 = this.basePrice;
                } else {
                    this.equilibriumQ1 = (this.demandIntercept - this.originalSupplyIntercept) / denominator;
                    this.equilibriumP1 = this.originalSupplyIntercept + this.supplySlope * this.equilibriumQ1;
                    
                    // ç¢ºä¿åœ¨åˆç†ç¯„åœå…§
                    this.equilibriumQ1 = Math.max(0, Math.min(80, this.equilibriumQ1));
                    this.equilibriumP1 = Math.max(0, Math.min(100, this.equilibriumP1));
                }
            }
            
            calculateNewEquilibrium() {
                // è¨ˆç®—éœ€æ±‚ç·šå’Œæ–°ä¾›çµ¦ç·šï¼ˆS2ï¼‰çš„äº¤é»
                // éœ€æ±‚ç·š: P = demandIntercept + demandSlope * Q
                // æ–°ä¾›çµ¦ç·š: P = supplyIntercept + supplySlope * Q
                
                const denominator = this.supplySlope - this.demandSlope;
                if (Math.abs(denominator) < 0.001) {
                    // ç·šæ¢å¹³è¡Œï¼Œä½¿ç”¨é è¨­å€¼
                    this.equilibriumQ2 = this.baseQuantity * 0.8; // å‡è¨­æ•¸é‡æ¸›å°‘
                    this.equilibriumP2 = this.basePrice * 1.2; // å‡è¨­åƒ¹æ ¼ä¸Šå‡
                } else {
                    this.equilibriumQ2 = (this.demandIntercept - this.supplyIntercept) / denominator;
                    this.equilibriumP2 = this.supplyIntercept + this.supplySlope * this.equilibriumQ2;
                    
                    // ç¢ºä¿åœ¨åˆç†ç¯„åœå…§
                    this.equilibriumQ2 = Math.max(0, Math.min(80, this.equilibriumQ2));
                    this.equilibriumP2 = Math.max(0, Math.min(100, this.equilibriumP2));
                }
            }
            
            selectElasticity(type) {
                // åªæœ‰åœ¨é€‰æ‹©äº†ä»é‡ç¨åæ‰èƒ½é€‰æ‹©å¼¹æ€§ç±»å‹
                if (!this.selectedUnitTax) {
                    return;
                }
                
                this.selectedElasticity = type;
                this.updateButtonStates('.elasticity-btn', type === 'high' ? 0 : 1);
                this.updateElasticityDisplay();
                this.updateSimulateButton();
                this.updatePredictionPanel();
                
                // é¡¯ç¤ºæç¤ºæ¡†ä¸¦é–‹å§‹é–ƒçˆå‹•ç•«
                this.showElasticityHint();
            }
            
            updateButtonStates(selector, activeIndex) {
                const buttons = document.querySelectorAll(selector);
                buttons.forEach((btn, index) => {
                    btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                    btn.classList.add('border-gray-300', 'dark:border-gray-600');
                    
                    if (index === activeIndex) {
                        btn.classList.remove('border-gray-300', 'dark:border-gray-600');
                        btn.classList.add('border-primary', 'bg-primary', 'text-white');
                    }
                });
            }
            
            updateElasticityDisplay() {
                // å½ˆæ€§ä¿‚æ•¸ä¸å†é¡¯ç¤ºï¼Œä½†ä»ç„¶è¨ˆç®—
                const elasticity = this.calculateElasticity();
                // ç§»é™¤é¡¯ç¤ºæ›´æ–°ï¼Œåªä¿ç•™è¨ˆç®—åŠŸèƒ½
            }
            
            calculateElasticity() {
                // åœ¨å‡è¡¡é»è¨ˆç®—é»å½ˆæ€§
                return this.demandSlope * (this.baseQuantity / this.basePrice);
            }
            
            updatePredictionPanel() {
                // ç§»é™¤é æ¸¬é¢æ¿åŠŸèƒ½ï¼Œå› ç‚ºé¢æ¿å·²è¢«åˆªé™¤
            }
            
            updateSimulateButton() {
                // ç§»é™¤æ¨¡æ“¬æŒ‰éˆ•åŠŸèƒ½ï¼Œå› ç‚ºæŒ‰éˆ•å·²è¢«åˆªé™¤
            }
            
            // åº§æ¨™è½‰æ›
            toCanvasX(x) {
                return this.margin.left + (x / 80) * this.chartWidth;
            }
            
            toCanvasY(y) {
                return this.margin.top + this.chartHeight - (y / 100) * this.chartHeight;
            }
            
            drawChart() {
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                const isDark = document.documentElement.classList.contains('dark');
                this.ctx.strokeStyle = isDark ? '#9CA3AF' : '#6B7280';
                this.ctx.fillStyle = isDark ? '#F3F4F6' : '#374151';
                this.ctx.font = '12px sans-serif';
                
                this.drawAxes();
                this.drawDemandLine();
                this.drawSupplyLine();
                this.drawPriceChangeIndicators();
                this.drawInstructions();
                
                // ç¹ªè£½æ‰€æœ‰æ‹–æ‹½æ¨™ç±¤ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                this.drawDraggedLabels();
            }
            
            drawAxes() {
                this.ctx.beginPath();
                
                // Yè»¸
                this.ctx.moveTo(this.margin.left, this.margin.top);
                this.ctx.lineTo(this.margin.left, this.height - this.margin.bottom);
                
                // Xè»¸
                this.ctx.moveTo(this.margin.left, this.height - this.margin.bottom);
                this.ctx.lineTo(this.width - this.margin.right, this.height - this.margin.bottom);
                
                this.ctx.stroke();
                
                // æ¨™ç±¤ - æ ¹æ®è¯­è¨€æ˜¾ç¤º
                const priceLabel = languageManager.currentLang === 'en' ? languageManager.getText('axisPrice') : 'åƒ¹æ ¼';
                const quantityLabel = languageManager.currentLang === 'en' ? languageManager.getText('axisQuantity') : 'æ•¸é‡';
                
                this.ctx.fillText(priceLabel, this.margin.left - 40, this.margin.top - 10);
                this.ctx.fillText(quantityLabel, this.width - this.margin.right + 10, this.height - this.margin.bottom + 15);
            }
            
            drawDemandLine() {
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#3B82F6';
                this.ctx.lineWidth = 3;
                
                // å°æ–¼æ¥è¿‘æ°´å¹³çš„ç·šæ¢ï¼Œä½¿ç”¨ç°¡åŒ–çš„ç¹ªè£½æ–¹æ³•
                if (Math.abs(this.demandSlope) < 0.001) {
                    // æ°´å¹³ç·šï¼šå¾å·¦åˆ°å³ç•«ä¸€æ¢ç›´ç·š
                    const y = this.basePrice; // ä¿æŒåœ¨åŸºæº–é»é«˜åº¦
                    this.ctx.moveTo(this.toCanvasX(0), this.toCanvasY(y));
                    this.ctx.lineTo(this.toCanvasX(80), this.toCanvasY(y));
                } else {
                    // æ­£å¸¸æ–œç‡çš„ç·šæ¢
                    // Yè»¸äº¤é» (x=0æ™‚çš„yå€¼)
                    const yAxisIntercept = this.demandIntercept;
                    // Xè»¸äº¤é» (y=0æ™‚çš„xå€¼) - åŠ å…¥å®‰å…¨æª¢æŸ¥
                    let xAxisIntercept = -this.demandIntercept / this.demandSlope;
                    
                    // é˜²æ­¢æ¥µå€¼è¨ˆç®—éŒ¯èª¤
                    if (!isFinite(xAxisIntercept)) {
                        xAxisIntercept = 10000; // è¨­å®šä¸€å€‹å¾ˆå¤§çš„å€¼
                    }
                    
                    // ç¢ºå®šç¹ªè£½ç¯„åœ
                    let startX = 0;
                    let startY = yAxisIntercept;
                    let endX = Math.min(80, Math.max(0, xAxisIntercept));
                    let endY = 0;
                    
                    // å¦‚æœYè»¸äº¤é»è¶…å‡ºç¯„åœï¼Œå¾åœ–è¡¨é ‚éƒ¨é–‹å§‹
                    if (startY > 100) {
                        startY = 100;
                        startX = Math.max(0, (100 - this.demandIntercept) / this.demandSlope);
                    }
                    if (startY < 0) {
                        startY = 0;
                        startX = Math.max(0, (0 - this.demandIntercept) / this.demandSlope);
                    }
                    
                    // å¦‚æœXè»¸äº¤é»è¶…å‡ºç¯„åœï¼Œå»¶ä¼¸åˆ°åœ–è¡¨å³é‚Šç•Œ
                    if (xAxisIntercept > 80 || xAxisIntercept < 0) {
                        endX = 80;
                        endY = this.demandIntercept + this.demandSlope * 80;
                        endY = Math.min(100, Math.max(0, endY));
                    }
                    
                    // æœ€çµ‚é‚Šç•Œæª¢æŸ¥
                    startX = Math.max(0, Math.min(80, startX));
                    startY = Math.min(100, Math.max(0, startY));
                    endX = Math.max(0, Math.min(80, endX));
                    endY = Math.min(100, Math.max(0, endY));
                    
                    this.ctx.moveTo(this.toCanvasX(startX), this.toCanvasY(startY));
                    this.ctx.lineTo(this.toCanvasX(endX), this.toCanvasY(endY));
                }
                
                this.ctx.stroke();
                
                // éœ€æ±‚ç·šæ¨™ç±¤ - Då­—çš„ä½ç½®æ ¹æ“šç·šæ¢é¡å‹èª¿æ•´
                this.ctx.fillStyle = '#3B82F6';
                this.ctx.font = 'bold 16px sans-serif';
                
                // è¨ˆç®—Då­—ä½ç½® - å‚ç›´ç·šç‰¹æ®Šè™•ç†ï¼Œå…¶ä»–éƒ½åœ¨å³ä¸‹æœ«ç«¯
                let dX, dY;
                
                if (Math.abs(this.demandSlope) > 100) {
                    // å‚ç›´ç·šï¼šDå­—åœ¨ç·šçš„è¼ƒé«˜å’Œè¼ƒå·¦ä½ç½®ï¼Œä½†ä»åœ¨ç·šçš„å³æ–¹
                    dX = this.baseQuantity + 2;  // è¼ƒå·¦ä½†ä»åœ¨ç·šå³æ–¹
                    dY = Math.max(15, this.basePrice + 40);  // è¼ƒé«˜
                } else {
                    // æ‰€æœ‰å…¶ä»–æƒ…æ³ï¼ˆæ°´å¹³ç·šå’Œå‚¾æ–œç·šï¼‰ï¼šDå­—åœ¨ç·šçš„å³ä¸‹æœ«ç«¯
                    // è¤‡ç”¨ç¹ªè£½é‚è¼¯æ‰¾åˆ°å¯¦éš›çš„ç·šæ¢çµ‚é»
                    const yAxisIntercept = this.demandIntercept;
                    let xAxisIntercept = -this.demandIntercept / this.demandSlope;
                    
                    if (!isFinite(xAxisIntercept)) {
                        xAxisIntercept = 10000;
                    }
                    
                    // ç¢ºå®šç¹ªè£½ç¯„åœï¼ˆèˆ‡drawDemandLineå®Œå…¨ç›¸åŒçš„é‚è¼¯ï¼‰
                    let startX = 0;
                    let startY = yAxisIntercept;
                    let endX = Math.min(80, Math.max(0, xAxisIntercept));
                    let endY = 0;
                    
                    // å¦‚æœYè»¸äº¤é»è¶…å‡ºç¯„åœï¼Œå¾åœ–è¡¨é ‚éƒ¨æˆ–åº•éƒ¨é–‹å§‹
                    if (startY > 100) {
                        startY = 100;
                        startX = Math.max(0, (100 - this.demandIntercept) / this.demandSlope);
                    }
                    if (startY < 0) {
                        startY = 0;
                        startX = Math.max(0, (0 - this.demandIntercept) / this.demandSlope);
                    }
                    
                    // å¦‚æœXè»¸äº¤é»è¶…å‡ºç¯„åœï¼Œå»¶ä¼¸åˆ°åœ–è¡¨å³é‚Šç•Œ
                    if (xAxisIntercept > 80 || xAxisIntercept < 0) {
                        endX = 80;
                        endY = this.demandIntercept + this.demandSlope * 80;
                        endY = Math.min(100, Math.max(0, endY));
                    }
                    
                    // æœ€çµ‚é‚Šç•Œæª¢æŸ¥
                    startX = Math.max(0, Math.min(80, startX));
                    startY = Math.min(100, Math.max(0, startY));
                    endX = Math.max(0, Math.min(80, endX));
                    endY = Math.min(100, Math.max(0, endY));
                    
                    // Då­—åœ¨å³ä¸‹æœ«ç«¯ï¼šé¸æ“‡æœ€å³é‚Šçš„é»ä½œç‚ºåŸºæº–
                    if (endX >= startX) {
                        // ä½¿ç”¨å³ç«¯é»
                        dX = endX + 3;  // ç¨å¾®å³ç§»ä¸€é»
                        dY = endY - 5;  // ç¨å¾®ä¸‹ç§»ä¸€é»
                    } else {
                        // ä½¿ç”¨èµ·å§‹é»
                        dX = startX + 3;
                        dY = startY - 5;
                    }
                }
                
                // ç¢ºä¿Då­—ä¸æœƒè¶…å‡ºåœ–è¡¨é‚Šç•Œ
                dX = Math.min(78, Math.max(2, dX));
                dY = Math.min(98, Math.max(12, dY));
                
                this.ctx.fillText('D', this.toCanvasX(dX), this.toCanvasY(dY));
                
                this.ctx.lineWidth = 1;
                this.ctx.font = '12px sans-serif';
            }
            
            drawSupplyLine() {
                // å…ˆç¹ªè£½åŸå§‹ä¾›çµ¦ç·šS1ï¼ˆå¦‚æœé¸æ“‡äº†å¾é‡ç¨…ï¼‰
                if (this.selectedUnitTax) {
                    this.drawOriginalSupplyLine();
                }
                
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#EF4444'; // ç´…è‰²
                this.ctx.lineWidth = 3;
                
                // ç¹ªè£½ç•¶å‰ä¾›çµ¦ç·šï¼ˆS1æˆ–S2ï¼‰
                const currentIntercept = this.selectedUnitTax ? this.supplyIntercept : this.originalSupplyIntercept;
                
                // Yè»¸äº¤é» (x=0æ™‚çš„yå€¼)
                const yAxisIntercept = currentIntercept;
                // Xè»¸äº¤é» (y=0æ™‚çš„xå€¼)
                let xAxisIntercept = -currentIntercept / this.supplySlope;
                
                // ç¢ºå®šç¹ªè£½ç¯„åœ
                let startX = 0;
                let startY = yAxisIntercept;
                let endX = 80;
                let endY = currentIntercept + this.supplySlope * 80;
                
                // å¦‚æœYè»¸äº¤é»è¶…å‡ºç¯„åœï¼Œèª¿æ•´èµ·å§‹é»
                if (startY < 0) {
                    startY = 0;
                    startX = Math.max(0, (0 - currentIntercept) / this.supplySlope);
                }
                if (startY > 100) {
                    startY = 100;
                    startX = Math.max(0, (100 - currentIntercept) / this.supplySlope);
                }
                
                // å¦‚æœå³ç«¯é»è¶…å‡ºç¯„åœï¼Œèª¿æ•´çµ‚æ­¢é»
                if (endY > 100) {
                    endY = 100;
                    endX = Math.max(0, (100 - currentIntercept) / this.supplySlope);
                }
                if (endY < 0) {
                    endY = 0;
                    endX = Math.max(0, (0 - currentIntercept) / this.supplySlope);
                }
                
                // æœ€çµ‚é‚Šç•Œæª¢æŸ¥
                startX = Math.max(0, Math.min(80, startX));
                startY = Math.min(100, Math.max(0, startY));
                endX = Math.max(0, Math.min(80, endX));
                endY = Math.min(100, Math.max(0, endY));
                
                this.ctx.moveTo(this.toCanvasX(startX), this.toCanvasY(startY));
                this.ctx.lineTo(this.toCanvasX(endX), this.toCanvasY(endY));
                this.ctx.stroke();
                
                // ä¾›çµ¦ç·šæ¨™ç±¤ - Så­—ä½ç½®åœ¨ç·šçš„å³ä¸Šæ–¹
                this.ctx.fillStyle = '#EF4444';
                this.ctx.font = 'bold 16px sans-serif';
                
                // Så­—åœ¨å³ä¸Šæœ«ç«¯
                let sX = endX + 1;  // S2å‘å³ç§»å‹•æ›´å¤š
                let sY = endY + 5;  // ç¨å¾®ä¸Šç§»ä¸€é»
                
                // ç¢ºä¿Så­—ä¸æœƒè¶…å‡ºåœ–è¡¨é‚Šç•Œ
                sX = Math.min(78, Math.max(2, sX));
                sY = Math.min(98, Math.max(12, sY));
                
                // é¡¯ç¤ºS1æˆ–S2æ¨™ç±¤
                const sLabel = this.selectedUnitTax ? 'S2' : 'S1';
                this.ctx.fillText(sLabel, this.toCanvasX(sX), this.toCanvasY(sY));
                
                // ç¹ªè£½å‡è¡¡é»å’Œç®­é ­ï¼ˆå¦‚æœé¸æ“‡äº†å¾é‡ç¨…ï¼‰
                if (this.selectedUnitTax) {
                    this.drawEquilibriumChanges();
                }
                
                this.ctx.lineWidth = 1;
                this.ctx.font = '12px sans-serif';
            }
            
            drawOriginalSupplyLine() {
                // ç¹ªè£½åŸå§‹ä¾›çµ¦ç·šS1ï¼ˆå¯¦ç·šï¼‰
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#EF4444'; // ç´…è‰²
                this.ctx.lineWidth = 2;
                // S1æ”¹ç‚ºå¯¦ç·šï¼Œä¸è¨­ç½®è™›ç·š
                
                // ä½¿ç”¨åŸå§‹æˆªè·
                const yAxisIntercept = this.originalSupplyIntercept;
                let xAxisIntercept = -this.originalSupplyIntercept / this.supplySlope;
                
                // ç¢ºå®šç¹ªè£½ç¯„åœ
                let startX = 0;
                let startY = yAxisIntercept;
                let endX = 80;
                let endY = this.originalSupplyIntercept + this.supplySlope * 80;
                
                // é‚Šç•Œè™•ç†
                if (startY < 0) {
                    startY = 0;
                    startX = Math.max(0, (0 - this.originalSupplyIntercept) / this.supplySlope);
                }
                if (startY > 100) {
                    startY = 100;
                    startX = Math.max(0, (100 - this.originalSupplyIntercept) / this.supplySlope);
                }
                
                if (endY > 100) {
                    endY = 100;
                    endX = Math.max(0, (100 - this.originalSupplyIntercept) / this.supplySlope);
                }
                if (endY < 0) {
                    endY = 0;
                    endX = Math.max(0, (0 - this.originalSupplyIntercept) / this.supplySlope);
                }
                
                startX = Math.max(0, Math.min(80, startX));
                startY = Math.min(100, Math.max(0, startY));
                endX = Math.max(0, Math.min(80, endX));
                endY = Math.min(100, Math.max(0, endY));
                
                this.ctx.moveTo(this.toCanvasX(startX), this.toCanvasY(startY));
                this.ctx.lineTo(this.toCanvasX(endX), this.toCanvasY(endY));
                this.ctx.stroke();
                
                // S1æ¨™ç±¤
                this.ctx.fillStyle = '#EF4444';
                this.ctx.font = 'bold 16px sans-serif';
                let s1X = endX + 2;  // S1å‘å³ç§»å‹•æ›´å¤š
                let s1Y = endY - 8;  // S1ä½ç½®é™ä½
                s1X = Math.min(78, Math.max(2, s1X));
                s1Y = Math.min(98, Math.max(12, s1Y));
                this.ctx.fillText('S1', this.toCanvasX(s1X), this.toCanvasY(s1Y));
                
                this.ctx.setLineDash([]); // é‡ç½®è™›ç·š
            }
            
            drawEquilibriumChanges() {
                // ç¹ªè£½å‡è¡¡é»è®ŠåŒ–å’Œç®­é ­
                const arrowColor = '#F97316'; // æ©™è‰²
                const arrowSize = 8;
                
                // ç¹ªè£½å‡è¡¡é»
                this.ctx.fillStyle = '#000000';
                
                // åŸå§‹å‡è¡¡é»E1
                if (this.equilibriumP1 && this.equilibriumQ1) {
                    this.ctx.beginPath();
                    this.ctx.arc(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(this.equilibriumP1), 4, 0, 2 * Math.PI);
                    this.ctx.fill();
                    
                    // E1æ¨™ç±¤
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.fillText('E1', this.toCanvasX(this.equilibriumQ1) + 6, this.toCanvasY(this.equilibriumP1) - 6);
                }
                
                // æ–°å‡è¡¡é»E2
                if (this.equilibriumP2 && this.equilibriumQ2) {
                    this.ctx.beginPath();
                    this.ctx.arc(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(this.equilibriumP2), 4, 0, 2 * Math.PI);
                    this.ctx.fill();
                    
                    // E2æ¨™ç±¤
                    this.ctx.fillText('E2', this.toCanvasX(this.equilibriumQ2) + 6, this.toCanvasY(this.equilibriumP2) - 6);
                }
                
                // è¨­ç½®æ©™è‰²ç®­é ­æ¨£å¼
                this.ctx.strokeStyle = arrowColor;
                this.ctx.lineWidth = 3;
                
                // S1â†’S2ç®­é ­ï¼ˆä¾›çµ¦ç·šå‘ä¸Šç§»å‹•ï¼‰
                if (this.equilibriumP1 && this.equilibriumQ1) {
                    const s1s2ArrowX = this.toCanvasX(this.equilibriumQ1) + 50; // åœ¨å‡è¡¡é»å³æ–¹
                    // è¨ˆç®—S1å’ŒS2ç·šåœ¨æ­¤ä½ç½®çš„Yå€¼
                    const xPosition = this.equilibriumQ1 + 6.25;
                    const s1LineY = this.originalSupplyIntercept + this.supplySlope * xPosition;
                    const s2LineY = this.supplyIntercept + this.supplySlope * xPosition;
                    
                    // ç®­é ­èµ·å§‹å’Œçµ‚æ­¢ä½ç½®èˆ‡ä¾›çµ¦ç·šä¿æŒ8pxè·é›¢
                    const lineGap = 8; // èˆ‡ç·šæ¢çš„é–“è·
                    const s1s2StartY = this.toCanvasY(s1LineY) - lineGap; // é›¢S1ç·š8px
                    const s1s2EndY = this.toCanvasY(s2LineY) + lineGap; // é›¢S2ç·š8px
                    
                    // å‚ç›´ç®­é ­ç·š
                    this.ctx.beginPath();
                    this.ctx.moveTo(s1s2ArrowX, s1s2StartY);
                    this.ctx.lineTo(s1s2ArrowX, s1s2EndY);
                    this.ctx.stroke();
                    
                    // å‘ä¸Šç®­é ­é ­éƒ¨ï¼ˆä¾›çµ¦ç·šå‘ä¸Šç§»å‹•ï¼‰
                    this.ctx.fillStyle = arrowColor;
                    this.ctx.beginPath();
                    this.ctx.moveTo(s1s2ArrowX, s1s2EndY); // ç®­é ­å°–ç«¯
                    this.ctx.lineTo(s1s2ArrowX - arrowSize/2, s1s2EndY + arrowSize); // å·¦ä¸‹
                    this.ctx.lineTo(s1s2ArrowX + arrowSize/2, s1s2EndY + arrowSize); // å³ä¸‹
                    this.ctx.closePath();
                    this.ctx.fill();
                }
                
                // P1â†’P2ç®­é ­ï¼ˆåƒ¹æ ¼ä¸Šå‡ï¼‰
                if (this.equilibriumP1 && this.equilibriumP2) {
                    const p1p2ArrowX = this.margin.left - 20;
                    const p1p2StartY = this.toCanvasY(this.equilibriumP1);
                    const p1p2EndY = this.toCanvasY(this.equilibriumP2);
                    
                    // å‚ç›´ç®­é ­ç·š
                    this.ctx.beginPath();
                    this.ctx.moveTo(p1p2ArrowX, p1p2StartY);
                    this.ctx.lineTo(p1p2ArrowX, p1p2EndY);
                    this.ctx.stroke();
                    
                    // å‘ä¸Šç®­é ­é ­éƒ¨ï¼ˆåƒ¹æ ¼ä¸Šå‡ï¼‰
                    this.ctx.fillStyle = arrowColor;
                    this.ctx.beginPath();
                    this.ctx.moveTo(p1p2ArrowX, p1p2EndY); // ç®­é ­å°–ç«¯
                    this.ctx.lineTo(p1p2ArrowX - arrowSize/2, p1p2EndY + arrowSize); // å·¦ä¸‹
                    this.ctx.lineTo(p1p2ArrowX + arrowSize/2, p1p2EndY + arrowSize); // å³ä¸‹
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // P1ã€P2æ¨™è¨»
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.textAlign = 'right';
                    this.ctx.fillStyle = '#000000';
                    this.ctx.fillText('P1', p1p2ArrowX - 5, p1p2StartY + 4);
                    this.ctx.fillText('P2', p1p2ArrowX - 5, p1p2EndY + 4);
                    this.ctx.textAlign = 'left';
                }
                
                // Q1â†’Q2ç®­é ­ï¼ˆæ•¸é‡æ¸›å°‘ï¼‰
                if (this.equilibriumQ1 && this.equilibriumQ2) {
                    const q1q2ArrowY = this.height - this.margin.bottom + 20;
                    const q1q2StartX = this.toCanvasX(this.equilibriumQ1);
                    const q1q2EndX = this.toCanvasX(this.equilibriumQ2);
                    
                    // æ°´å¹³ç®­é ­ç·š
                    this.ctx.beginPath();
                    this.ctx.moveTo(q1q2StartX, q1q2ArrowY);
                    this.ctx.lineTo(q1q2EndX, q1q2ArrowY);
                    this.ctx.stroke();
                    
                    // å‘å·¦ç®­é ­é ­éƒ¨ï¼ˆæ•¸é‡æ¸›å°‘ï¼ŒQ1â†’Q2ï¼Œå³å¾å³å‘å·¦ï¼‰
                    this.ctx.fillStyle = arrowColor;
                    this.ctx.beginPath();
                    this.ctx.moveTo(q1q2EndX, q1q2ArrowY); // ç®­é ­å°–ç«¯
                    this.ctx.lineTo(q1q2EndX + arrowSize, q1q2ArrowY - arrowSize/2); // å³ä¸Š
                    this.ctx.lineTo(q1q2EndX + arrowSize, q1q2ArrowY + arrowSize/2); // å³ä¸‹
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // Q1ã€Q2æ¨™è¨»
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillStyle = '#000000';
                    this.ctx.fillText('Q1', q1q2StartX, q1q2ArrowY + 20);
                    this.ctx.fillText('Q2', q1q2EndX, q1q2ArrowY + 20);
                    this.ctx.textAlign = 'left';
                }
                
                this.ctx.lineWidth = 1;
                this.ctx.fillStyle = '#000000'; // é‡ç½®å¡«å……è‰²ç‚ºé»‘è‰²
            }
            
            drawPriceChangeIndicators() {
                // ä»é‡ç¨æƒ…å†µä¸‹ï¼Œå§‹ç»ˆæ˜¾ç¤ºåŠ ä»·çš„å›¾è¡¨å…ƒç´ 
                if (!this.selectedUnitTax) return;
                
                // ä½¿ç”¨å¯¦éš›è¨ˆç®—çš„å‡è¡¡é»ï¼Œè€Œä¸æ˜¯å›ºå®šå€¼
                if (!this.equilibriumP1 || !this.equilibriumQ1 || !this.equilibriumP2 || !this.equilibriumQ2) return;
                
                // ç¹ªè£½E1çš„è™›ç·š (åŸå§‹å‡è¡¡é»çš„æŠ•å½±ç·š)
                this.ctx.setLineDash([5, 5]);
                this.ctx.strokeStyle = '#9CA3AF';
                this.ctx.lineWidth = 2;
                
                // P1æ°´å¹³ç·šï¼šå¾Yè»¸åˆ°E1é»
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(0), this.toCanvasY(this.equilibriumP1));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(this.equilibriumP1));
                this.ctx.stroke();
                
                // Q1å‚ç›´ç·šï¼šå¾E1é»åˆ°Xè»¸
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(this.equilibriumP1));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(0));
                this.ctx.stroke();
                
                // ç¹ªè£½E2çš„è™›ç·š (æ–°å‡è¡¡é»çš„æŠ•å½±ç·š)
                // P2æ°´å¹³ç·šï¼šå¾Yè»¸åˆ°E2é»
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(0), this.toCanvasY(this.equilibriumP2));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(this.equilibriumP2));
                this.ctx.stroke();
                
                // Q2å‚ç›´ç·šï¼šå¾E2é»åˆ°Xè»¸
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(this.equilibriumP2));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(0));
                this.ctx.stroke();
                
                this.ctx.setLineDash([]); // é‡ç½®è™›ç·š
                
                this.ctx.lineWidth = 1;
            }
            
            drawPriceArrows(newPrice) {
                const arrowColor = '#F97316'; // æ©™è‰²
                const arrowSize = 8;
                
                // Yè»¸ç®­é ­ (åƒ¹æ ¼è®ŠåŒ–)
                const yArrowX = this.margin.left - 15;
                const yArrowStartY = this.toCanvasY(this.basePrice);
                const yArrowEndY = this.toCanvasY(newPrice);
                
                this.ctx.strokeStyle = arrowColor;
                this.ctx.fillStyle = arrowColor;
                this.ctx.lineWidth = 2;
                
                // Yè»¸ç®­é ­ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(yArrowX, yArrowStartY);
                this.ctx.lineTo(yArrowX, yArrowEndY);
                this.ctx.stroke();
                
                // Yè»¸ç®­é ­é ­éƒ¨
                const yDirection = yArrowEndY < yArrowStartY ? 1 : -1; // ä¿®æ­£ç®­é ­æ–¹å‘
                this.ctx.beginPath();
                this.ctx.moveTo(yArrowX, yArrowEndY);
                this.ctx.lineTo(yArrowX - arrowSize/2, yArrowEndY + yDirection * arrowSize);
                this.ctx.lineTo(yArrowX + arrowSize/2, yArrowEndY + yDirection * arrowSize);
                this.ctx.closePath();
                this.ctx.fill();
                
                // Yè»¸åƒ¹æ ¼æ¨™è¨» (P1 â†’ P2)
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'right';
                this.ctx.fillStyle = '#000000'; // é»‘è‰²
                
                // P1æ¨™è¨» (åŸå§‹åƒ¹æ ¼)
                this.ctx.fillText('P1', yArrowX - 5, yArrowStartY + 4);
                
                // P2æ¨™è¨» (æ–°åƒ¹æ ¼)
                this.ctx.fillText('P2', yArrowX - 5, yArrowEndY + 4);
                
                // é‡ç½®æ–‡å­—å°é½Š
                this.ctx.textAlign = 'left';
                this.ctx.font = '12px sans-serif';
                
                // è¨ˆç®—Q2åœ¨éœ€æ±‚ç·šä¸Šçš„çœŸæ­£ä½ç½®ï¼ˆèˆ‡P2è™›ç·šä¸€è‡´ï¼‰
                let q2QuantityOnDemandLine;
                if (Math.abs(this.demandSlope) < 0.001) {
                    // æ°´å¹³éœ€æ±‚ç·šæƒ…æ³
                    q2QuantityOnDemandLine = this.baseQuantity; // ä¿æŒç›¸åŒæ•¸é‡
                } else {
                    // é€šééœ€æ±‚ç·šæ–¹ç¨‹è¨ˆç®—ï¼šQ = (P - intercept) / slope
                    q2QuantityOnDemandLine = (newPrice - this.demandIntercept) / this.demandSlope;
                    // ç¢ºä¿åœ¨åœ–è¡¨ç¯„åœå…§
                    q2QuantityOnDemandLine = Math.max(0, Math.min(80, q2QuantityOnDemandLine));
                }
                
                // Xè»¸ç®­é ­ (æ•¸é‡è®ŠåŒ–) - æŒ‡å‘Q2çš„æ­£ç¢ºä½ç½®
                const xArrowY = this.height - this.margin.bottom + 15;
                const xArrowStartX = this.toCanvasX(this.baseQuantity);
                const xArrowEndX = this.toCanvasX(q2QuantityOnDemandLine);
                
                // Xè»¸ç®­é ­ä¿æŒæ©™è‰²
                this.ctx.strokeStyle = arrowColor;
                this.ctx.fillStyle = arrowColor;
                
                // Xè»¸ç®­é ­ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(xArrowStartX, xArrowY);
                this.ctx.lineTo(xArrowEndX, xArrowY);
                this.ctx.stroke();
                
                // Xè»¸ç®­é ­é ­éƒ¨
                const xDirection = q2QuantityOnDemandLine > this.baseQuantity ? 1 : -1; // ç®­é ­æŒ‡å‘
                this.ctx.beginPath();
                this.ctx.moveTo(xArrowEndX, xArrowY);
                this.ctx.lineTo(xArrowEndX - xDirection * arrowSize, xArrowY - arrowSize/2);
                this.ctx.lineTo(xArrowEndX - xDirection * arrowSize, xArrowY + arrowSize/2);
                this.ctx.closePath();
                this.ctx.fill();
                
                // Xè»¸æ•¸é‡æ¨™è¨» (Q1 â†’ Q2)
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.fillStyle = '#000000'; // é»‘è‰²
                
                // Q1æ¨™è¨» (åŸå§‹æ•¸é‡)
                this.ctx.fillText('Q1', xArrowStartX, xArrowY + 20);
                
                // Q2æ¨™è¨» (æ–°æ•¸é‡) - ä½¿ç”¨éœ€æ±‚ç·šä¸Šçš„æ­£ç¢ºä½ç½®
                this.ctx.fillText('Q2', this.toCanvasX(q2QuantityOnDemandLine), xArrowY + 20);
                
                // é‡ç½®æ–‡å­—å°é½Š
                this.ctx.textAlign = 'left';
                this.ctx.font = '12px sans-serif';
            }
            
            drawInstructions() {
                // ç¹ªè£½æç¤ºæ¡†
                if (this.showHint) {
                    this.drawHintBox();
                }
                
                // ç¹ªè£½æ¯”è¼ƒæ¡†ï¼ˆä»»å‹™4ï¼‰- ä¸€é–‹å§‹å°±é¡¯ç¤º
                this.drawComparisonBox();
            }
            
            showElasticityHint() {
                this.showHint = true;
                this.hintOpacity = 1;
                this.drawChart();
                
                // æŒçºŒé–ƒçˆå‹•ç•«ï¼Œç›´åˆ°ç”¨æˆ¶é–‹å§‹æ‹–æ‹½
                if (this.hintInterval) {
                    clearInterval(this.hintInterval);
                }
                
                this.hintInterval = setInterval(() => {
                    if (this.showHint) {
                        this.hintOpacity = this.hintOpacity === 1 ? 0.3 : 1;
                        this.drawChart();
                    }
                }, 300);
            }
            
            hideHint() {
                this.showHint = false;
                if (this.hintInterval) {
                    clearInterval(this.hintInterval);
                    this.hintInterval = null;
                }
                this.drawChart();
            }
            
            drawHintBox() {
                const isDark = document.documentElement.classList.contains('dark');
                
                // è¨ˆç®—æç¤ºæ¡†ä½ç½®ï¼ˆåœ–è¡¨ä¸Šæ–¹ä½†ç¢ºä¿å¯è¦‹ï¼‰- å¢å¤§å°ºå¯¸
                const boxWidth = 280;
                const boxHeight = 70;
                const boxX = this.margin.left + (this.chartWidth - boxWidth) / 2;
                const boxY = Math.max(5, this.margin.top - boxHeight + 5); // ç¢ºä¿è·é›¢é ‚éƒ¨è‡³å°‘5px
                
                // è¨­ç½®é€æ˜åº¦
                this.ctx.globalAlpha = this.hintOpacity;
                
                // ç¹ªè£½èƒŒæ™¯æ¡†
                this.ctx.fillStyle = isDark ? 'rgba(55, 65, 81, 0.95)' : 'rgba(248, 250, 252, 0.95)';
                this.ctx.strokeStyle = '#EF4444'; // ç´…è‰²é‚Šæ¡†
                this.ctx.lineWidth = 3;
                
                // ç¹ªè£½åœ“è§’çŸ©å½¢
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                this.ctx.stroke();
                
                // ç¹ªè£½æ–‡å­— - æ ¹æ®è¯­è¨€æ˜¾ç¤º
                this.ctx.fillStyle = isDark ? '#F3F4F6' : '#374151';
                this.ctx.font = 'bold 16px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                const hintText = languageManager.currentLang === 'en' ? 
                    languageManager.getText('hintChangeAngle') : 'æ”¹è®Šéœ€æ±‚æ›²ç·šè§’åº¦';
                
                this.ctx.fillText(hintText, boxX + boxWidth/2, boxY + boxHeight/2);
                
                // é‡ç½®è¨­å®š
                this.ctx.globalAlpha = 1;
                this.ctx.textAlign = 'left';
                this.ctx.textBaseline = 'alphabetic';
                this.ctx.lineWidth = 1;
            }
            
            roundRect(x, y, width, height, radius) {
                this.ctx.beginPath();
                this.ctx.moveTo(x + radius, y);
                this.ctx.lineTo(x + width - radius, y);
                this.ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.ctx.lineTo(x + width, y + height - radius);
                this.ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.ctx.lineTo(x + radius, y + height);
                this.ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.ctx.lineTo(x, y + radius);
                this.ctx.quadraticCurveTo(x, y, x + radius, y);
                this.ctx.closePath();
            }
            
            submitAnswer() {
                // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆå‰å››å€‹ä»»å‹™
                if (!this.selectedUnitTax || !this.selectedElasticity || !this.selectedBenefit || !this.isDraggedToCanvas || !this.selectedComparison || !this.isComparisonDraggedToCanvas) {
                    const submitFeedback = document.getElementById('submitFeedback');
                    submitFeedback.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'dark:bg-green-900', 'dark:bg-red-900');
                    submitFeedback.classList.add('bg-yellow-100', 'dark:bg-yellow-900', 'text-yellow-800', 'dark:text-yellow-200');
                    
                    if (!this.selectedUnitTax || !this.selectedElasticity) {
                        const message = languageManager.currentLang === 'en' ? 
                            'Please complete Task 1 and Task 2 first.' : 
                            'è«‹å…ˆå®Œæˆä»»å‹™1å’Œä»»å‹™2çš„é¸æ“‡ã€‚';
                        submitFeedback.textContent = message;
                    } else if (!this.isDraggedToCanvas) {
                        const message = languageManager.currentLang === 'en' ? 
                            'Please drag the Task 3 answer to the P1-P2 or Q1-Q2 area on the chart.' : 
                            'è«‹å°‡ä»»å‹™3çš„ç­”æ¡ˆæ‹–æ‹½åˆ°åœ–è¡¨çš„P1-P2æˆ–Q1-Q2å€åŸŸã€‚';
                        submitFeedback.textContent = message;
                    } else if (!this.isComparisonDraggedToCanvas) {
                        const message = languageManager.currentLang === 'en' ? 
                            'Please drag the Task 4 comparison symbol to the comparison box at the top right of the chart.' : 
                            'è«‹å°‡ä»»å‹™4çš„æ¯”è¼ƒç¬¦è™Ÿæ‹–æ‹½åˆ°åœ–è¡¨å³ä¸Šæ–¹çš„æ¯”è¼ƒæ¡†ä¸­ã€‚';
                        submitFeedback.textContent = message;
                    } else {
                        const message = languageManager.currentLang === 'en' ? 
                            'Please complete all task selections first.' : 
                            'è«‹å…ˆå®Œæˆæ‰€æœ‰ä»»å‹™çš„é¸æ“‡ã€‚';
                        submitFeedback.textContent = message;
                    }
                    return;
                }
                
                // è¨ˆç®—å¯¦éš›çš„å¾—ç›Šå’Œæå¤±é¢ç©
                const areaResult = this.calculateBenefitLossAreas();
                const benefitArea = areaResult.benefitArea;
                const lossArea = areaResult.lossArea;
                
                // æ ¹æ“šé¢ç©æ¯”è¼ƒç¢ºå®šæ­£ç¢ºç­”æ¡ˆ
                const actualResult = benefitArea > lossArea ? 'benefit' : 'loss';
                const correctComparison = benefitArea > lossArea ? '>' : '<';
                
                // ç²å–å­¸ç”Ÿå¯¦éš›æ‹–æ‹½åˆ°çš„å€åŸŸå’Œæ¯”è¼ƒç¬¦è™Ÿ
                const studentZone = this.draggedPositions[this.selectedBenefit]?.zone;
                const studentComparison = this.selectedComparison;
                
                // é¡¯ç¤ºçµæœ
                const submitFeedback = document.getElementById('submitFeedback');
                submitFeedback.classList.remove('hidden', 'bg-yellow-100', 'dark:bg-yellow-900');
                
                // æª¢æŸ¥ç­”æ¡ˆæ­£ç¢ºæ€§ - åªéœ€è¦æª¢æŸ¥æ¯”è¼ƒç¬¦è™Ÿæ˜¯å¦æ­£ç¢º
                const isComparisonCorrect = studentComparison === correctComparison;
                const isZoneReasonable = studentZone !== null; // åªè¦æ”¾åœ¨äº†æœ‰æ•ˆå€åŸŸå°±ç®—åˆç†
                
                if (isComparisonCorrect && isZoneReasonable) {
                    submitFeedback.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                    
                    const successMessage = languageManager.currentLang === 'en' ? 
                        `Completely correct! Gain ${correctComparison} Loss.` : 
                        `å®Œå…¨æ­£ç¢ºï¼å¾—ç›Š${correctComparison}æå¤±ã€‚`;
                    submitFeedback.textContent = successMessage;
                    
                    // æ¨™è¨˜ç•¶å‰å½ˆæ€§é¡å‹å·²å®Œæˆ
                    this.completedTasks[this.selectedElasticity] = true;
                    this.updateQuizAvailability();
                } else {
                    submitFeedback.classList.add('bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200');
                    
                    const errorPrefix = languageManager.currentLang === 'en' ? 'Error!' : 'éŒ¯èª¤ï¼';
                    let errorMessage = errorPrefix;
                    
                    if (!isComparisonCorrect) {
                        if (benefitArea > lossArea) {
                            const comparisonError = languageManager.currentLang === 'en' ? 
                                ' Gain area > Loss area, should choose > symbol.' : 
                                ' å¾—ç›Šé¢ç© > æå¤±é¢ç©ï¼Œæ‡‰è©²é¸æ“‡ > ç¬¦è™Ÿã€‚';
                            errorMessage += comparisonError;
                        } else {
                            const comparisonError = languageManager.currentLang === 'en' ? 
                                ' Loss area > Gain area, should choose < symbol.' : 
                                ' æå¤±é¢ç© > å¾—ç›Šé¢ç©ï¼Œæ‡‰è©²é¸æ“‡ < ç¬¦è™Ÿã€‚';
                            errorMessage += comparisonError;
                        }
                    }
                    
                    if (!isZoneReasonable) {
                        const zoneError = languageManager.currentLang === 'en' ? 
                            ' Please ensure the answer is dragged to a valid area.' : 
                            ' è«‹ç¢ºä¿ç­”æ¡ˆå·²æ‹–æ‹½åˆ°æœ‰æ•ˆå€åŸŸã€‚';
                        errorMessage += zoneError;
                    }
                    
                    const explanation = this.getAreaExplanation(benefitArea, lossArea);
                    submitFeedback.textContent = `${errorMessage} ${explanation}`;
                }
                
                // ä¸è‡ªå‹•éš±è—åé¥‹ï¼Œè®“å­¸ç”ŸæŸ¥çœ‹çµæœ
            }
            
            calculateBenefitLossAreas() {
                if (!this.selectedElasticity) return { benefitArea: 0, lossArea: 0 };
                
                // ä»é‡ç¨ç›¸å½“äºåŠ ä»·
                const priceChangeDirection = 1;
                const newPrice = this.basePrice * (1 + priceChangeDirection * this.priceChangePercent);
                
                // ä½¿ç”¨é¸æ“‡çš„å½ˆæ€§é¡å‹ä¾†è¨ˆç®—Q2
                let q2QuantityOnDemandLine;
                
                if (this.selectedElasticity === 'high') {
                    // é«˜å½ˆæ€§ï¼šä½¿ç”¨å½ˆæ€§ä¿‚æ•¸ -2.0 ä¾†è¨ˆç®—æ•¸é‡è®ŠåŒ–
                    const elasticity = -2.0;
                    const priceChangePercent = priceChangeDirection * this.priceChangePercent;
                    const quantityChangePercent = elasticity * priceChangePercent;
                    q2QuantityOnDemandLine = this.baseQuantity * (1 + quantityChangePercent);
                } else {
                    // ä½å½ˆæ€§ï¼šä½¿ç”¨å½ˆæ€§ä¿‚æ•¸ -0.4 ä¾†è¨ˆç®—æ•¸é‡è®ŠåŒ–
                    const elasticity = -0.4;
                    const priceChangePercent = priceChangeDirection * this.priceChangePercent;
                    const quantityChangePercent = elasticity * priceChangePercent;
                    q2QuantityOnDemandLine = this.baseQuantity * (1 + quantityChangePercent);
                }
                
                // ç¢ºä¿Q2åœ¨åˆç†ç¯„åœå…§
                q2QuantityOnDemandLine = Math.max(0, Math.min(80, q2QuantityOnDemandLine));
                
                // ä»é‡ç¨åŠ ä»·æƒ…å†µï¼š
                // P1-P2å€åŸŸï¼ˆå¾—ç›Šï¼‰= (P2-P1) Ã— Q2ï¼ˆè¼ƒå°æ•¸é‡ï¼‰
                // Q1-Q2å€åŸŸï¼ˆæå¤±ï¼‰= P1 Ã— (Q1-Q2)
                const priceIncrease = newPrice - this.basePrice;
                const quantityDecrease = this.baseQuantity - q2QuantityOnDemandLine;
                
                const benefitArea = priceIncrease * q2QuantityOnDemandLine; // P1-P2å€åŸŸ
                const lossArea = this.basePrice * quantityDecrease; // Q1-Q2å€åŸŸ
                
                return {
                    benefitArea: Math.max(0, benefitArea),
                    lossArea: Math.max(0, lossArea)
                };
            }
            
            getAreaExplanation(benefitArea, lossArea) {
                return languageManager.currentLang === 'en' ? 
                    'Under unit tax: P1-P2 area represents "gain" (price increase Ã— remaining quantity), Q1-Q2 area represents "loss" (original price Ã— quantity decrease).' :
                    `å¾é‡ç¨…åŠ åƒ¹æ™‚ï¼šP1-P2å€åŸŸç‚ºã€Œå¾—ç›Šã€é¢ç©(åƒ¹æ ¼å¢åŠ Ã—å‰©é¤˜æ•¸é‡)ï¼ŒQ1-Q2å€åŸŸç‚ºã€Œæå¤±ã€é¢ç©(åŸåƒ¹æ ¼Ã—æ¸›å°‘æ•¸é‡)ã€‚`;
            }
            
            resetAll() {
                // é‡ç½®æ‰€æœ‰é¸æ“‡
                this.selectedUnitTax = false;
                this.selectedElasticity = null;
                this.selectedBenefit = null;
                this.prediction = null;
                this.isDraggedToCanvas = false; // é‡ç½®æ‹–æ‹½ç‹€æ…‹
                this.draggedPositions = {}; // æ¸…é™¤æ‰€æœ‰æ‹–æ‹½æ¨™ç±¤
                this.hasModifiedDemandLine = false; // é‡ç½®éœ€æ±‚ç·šä¿®æ”¹ç‹€æ…‹
                
                // é‡ç½®ä»»å‹™4æ¯”è¼ƒç¬¦è™Ÿç‹€æ…‹
                this.selectedComparison = null;
                this.isComparisonDraggedToCanvas = false;
                
                // é‡ç½®éœ€æ±‚ç·šåƒæ•¸
                this.demandSlope = -1.0;
                this.demandIntercept = 90;
                
                // é‡ç½®ä¾›çµ¦ç·šåƒæ•¸
                this.supplyIntercept = this.originalSupplyIntercept;
                
                // é‡ç½®å‡è¡¡é»åƒæ•¸
                this.equilibriumP1 = null;
                this.equilibriumQ1 = null;
                this.equilibriumP2 = null;
                this.equilibriumQ2 = null;
                
                // é‡ç½®æ‰€æœ‰æŒ‰éˆ•ç‹€æ…‹
                document.querySelectorAll('.tax-btn, .elasticity-btn, .benefit-btn, .comparison-btn').forEach(btn => {
                    btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                    btn.classList.add('border-gray-300', 'dark:border-gray-600');
                });
                
                // æ¢å¾©æ‹–æ‹½æŒ‰éˆ•çš„åŸå§‹æ¨£å¼
                const benefitBtn = document.getElementById('benefit');
                const lossBtn = document.getElementById('loss');
                benefitBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                benefitBtn.classList.add('border-green-500', 'bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                lossBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                lossBtn.classList.add('border-red-500', 'bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200');
                
                // éš±è—æ‰€æœ‰åé¥‹é¢æ¿
                document.getElementById('submitFeedback').classList.add('hidden');
                const resultsPanel = document.getElementById('resultsPanel');
                if (resultsPanel) {
                    resultsPanel.classList.add('hidden');
                }
                
                // æ›´æ–°ä»»å‹™å¯ç”¨æ€§
                this.updateTaskAvailability();
                
                // é‡ç½®é¡¯ç¤º
                this.updateElasticityDisplay();
                this.updateSimulateButton();
                this.drawChart();
            }
            
            updateTaskAvailability() {
                // ä»»å‹™2ï¼ˆå¼¹æ€§ç±»å‹ï¼‰æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
                const elasticityButtons = document.querySelectorAll('.elasticity-btn');
                
                elasticityButtons.forEach(btn => {
                    if (this.selectedUnitTax) {
                        // å•Ÿç”¨ä»»å‹™2ï¼ˆé€‰æ‹©äº†ä»é‡ç¨åï¼‰
                        btn.disabled = false;
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                        btn.classList.add('hover:border-primary');
                    } else {
                        // ç¦ç”¨ä»»å‹™2
                        btn.disabled = true;
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                        btn.classList.remove('hover:border-primary');
                    }
                });
                
                // ä»»å‹™3æ‹–æ‹½æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
                const benefitButtons = document.querySelectorAll('.benefit-btn');
                benefitButtons.forEach(btn => {
                    if (this.selectedUnitTax && this.selectedElasticity && this.hasModifiedDemandLine) {
                        // å•Ÿç”¨ä»»å‹™3ï¼ˆå®Œæˆä»»åŠ¡1ã€2ä¸”ä¿®æ”¹äº†éœ€æ±‚çº¿ï¼‰
                        btn.style.pointerEvents = 'auto';
                        btn.classList.remove('opacity-50');
                        btn.setAttribute('draggable', 'true');
                    } else {
                        // ç¦ç”¨ä»»å‹™3
                        btn.style.pointerEvents = 'none';
                        btn.classList.add('opacity-50');
                        btn.setAttribute('draggable', 'false');
                    }
                });
                
                // ä»»å‹™4æ¯”è¼ƒç¬¦è™Ÿæ‹–æ‹½æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
                const comparisonButtons = document.querySelectorAll('.comparison-btn');
                comparisonButtons.forEach(btn => {
                    if (this.selectedUnitTax && this.selectedElasticity && this.hasModifiedDemandLine && this.isDraggedToCanvas) {
                        // å•Ÿç”¨ä»»å‹™4
                        btn.style.pointerEvents = 'auto';
                        btn.classList.remove('opacity-50');
                        btn.setAttribute('draggable', 'true');
                    } else {
                        // ç¦ç”¨ä»»å‹™4
                        btn.style.pointerEvents = 'none';
                        btn.classList.add('opacity-50');
                        btn.setAttribute('draggable', 'false');
                    }
                });
            }
            
            // ä»»å‹™4ï¼šæ¯”è¼ƒæ¡†ç›¸é—œå‡½æ•¸
            drawComparisonBox() {
                const isDark = document.documentElement.classList.contains('dark');
                
                // æ¯”è¼ƒæ¡†ä½ç½®ï¼ˆDå­—èˆ‡Så­—ä¹‹é–“ï¼‰
                const boxWidth = 140;
                const boxHeight = 40;
                // è¨ˆç®—Då­—å’ŒSå­—çš„å¤§æ¦‚ä½ç½®ä¾†å®šä½æ¯”è¼ƒæ¡†åœ¨ä¸­é–“
                const dApproxX = this.width - this.margin.right - 120; // Då­—å¤§æ¦‚ä½ç½®
                const dApproxY = this.height - this.margin.bottom - 80; // Då­—å¤§æ¦‚ä½ç½®
                const sApproxX = this.width - this.margin.right - 60; // Så­—å¤§æ¦‚ä½ç½®
                const sApproxY = this.margin.top + 60; // Så­—å¤§æ¦‚ä½ç½®
                
                // æ¯”è¼ƒæ¡†ä½ç½®åœ¨Då­—å’ŒSå­—çš„ä¸­é–“
                const boxX = Math.min(dApproxX, sApproxX) + 10; // å–è¼ƒå·¦çš„ä½ç½®ä¸¦ç¨å¾®å³ç§»
                const boxY = (dApproxY + sApproxY) / 2 - boxHeight / 2; // Yè»¸ä¸­é–“ä½ç½®
                
                this.ctx.save();
                
                // ç¹ªè£½èƒŒæ™¯æ¡†
                this.ctx.fillStyle = isDark ? 'rgba(55, 65, 81, 0.95)' : 'rgba(248, 250, 252, 0.95)';
                this.ctx.strokeStyle = '#6B7280';
                this.ctx.lineWidth = 2;
                
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                this.ctx.stroke();
                
                // ç¹ªè£½æ–‡å­— - æ ¹æ®è¯­è¨€æ˜¾ç¤º
                this.ctx.fillStyle = isDark ? '#F3F4F6' : '#374151';
                this.ctx.font = 'bold 14px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                const centerY = boxY + boxHeight / 2;
                
                // è·å–æ–‡å­—å†…å®¹
                const gainText = languageManager.currentLang === 'en' ? languageManager.getText('gainText') : 'å¾—ç›Š';
                const lossText = languageManager.currentLang === 'en' ? languageManager.getText('lossText') : 'æå¤±';
                
                // "å¾—ç›Š/Gain" æ–‡å­— - ç´…è‰²
                this.ctx.fillStyle = '#EF4444'; // ç´…è‰²
                this.ctx.fillText(gainText, boxX + 25, centerY);
                
                // æ¯”è¼ƒç¬¦è™Ÿä½ç½®
                const symbolX = boxX + boxWidth / 2;
                if (this.selectedComparison) {
                    // é¡¯ç¤ºå·²é¸æ“‡çš„æ¯”è¼ƒç¬¦è™Ÿ
                    this.ctx.fillStyle = '#EF4444'; // ç´…è‰²
                    this.ctx.font = 'bold 20px sans-serif';
                    this.ctx.fillText(this.selectedComparison, symbolX, centerY);
                } else if (this.isDraggedToCanvas && !this.selectedComparison) {
                    // å®Œæˆä»»å‹™3å¾Œé¡¯ç¤ºé–ƒçˆæç¤ºæ¡†
                    this.drawFlashingHint(symbolX, centerY);
                }
                
                // "æå¤±/Loss" æ–‡å­— - ç´…è‰²
                this.ctx.fillStyle = '#EF4444'; // ç´…è‰²
                this.ctx.font = 'bold 14px sans-serif';
                this.ctx.fillText(lossText, boxX + boxWidth - 25, centerY);
                
                this.ctx.restore();
            }
            
            getComparisonDropZone(canvasX, canvasY) {
                // æ¯”è¼ƒæ¡†çš„æ‹–æ‹½å€åŸŸ - èˆ‡é¡¯ç¤ºä½ç½®ä¿æŒä¸€è‡´
                const boxWidth = 140;
                const boxHeight = 40;
                // è¨ˆç®—Då­—å’ŒSå­—çš„å¤§æ¦‚ä½ç½®ä¾†å®šä½æ¯”è¼ƒæ¡†åœ¨ä¸­é–“ï¼ˆèˆ‡é¡¯ç¤ºä½ç½®ä¸€è‡´ï¼‰
                const dApproxX = this.width - this.margin.right - 120; // Då­—å¤§æ¦‚ä½ç½®
                const dApproxY = this.height - this.margin.bottom - 80; // Då­—å¤§æ¦‚ä½ç½®
                const sApproxX = this.width - this.margin.right - 60; // Så­—å¤§æ¦‚ä½ç½®
                const sApproxY = this.margin.top + 60; // Så­—å¤§æ¦‚ä½ç½®
                
                // æ¯”è¼ƒæ¡†ä½ç½®åœ¨Då­—å’ŒSå­—çš„ä¸­é–“
                const boxX = Math.min(dApproxX, sApproxX) + 10; // å–è¼ƒå·¦çš„ä½ç½®ä¸¦ç¨å¾®å³ç§»
                const boxY = (dApproxY + sApproxY) / 2 - boxHeight / 2; // Yè»¸ä¸­é–“ä½ç½®
                
                // æª¢æŸ¥æ˜¯å¦åœ¨æ¯”è¼ƒæ¡†å€åŸŸå…§
                if (canvasX >= boxX && canvasX <= boxX + boxWidth && 
                    canvasY >= boxY && canvasY <= boxY + boxHeight) {
                    return 'comparison';
                }
                
                return null;
            }
            
            showComparisonDropConfirmation(symbol) {
                this.ctx.save();
                
                const message = languageManager.currentLang === 'en' ? 
                    `Placed comparison symbol: ${symbol}` : `å·²æ”¾ç½®æ¯”è¼ƒç¬¦è™Ÿï¼š${symbol}`;
                const bgColor = '#10B981'; // ç¶ è‰²ï¼Œè¡¨ç¤ºæˆåŠŸ
                
                const boxX = this.width / 2 - 80;
                const boxY = this.margin.top + 60;
                const boxWidth = 160;
                const boxHeight = 30;
                
                // èƒŒæ™¯
                this.ctx.fillStyle = bgColor;
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                // æ–‡å­—
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                // 2ç§’å¾Œæ¸…é™¤è¨Šæ¯
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            showComparisonDropError() {
                this.ctx.save();
                
                const message = languageManager.currentLang === 'en' ? 
                    languageManager.getText('comparisonError') : 'è«‹æ‹–æ‹½åˆ°åœ–è¡¨å³ä¸Šæ–¹çš„æ¯”è¼ƒæ¡†ä¸­';
                const boxX = this.width / 2 - 120;
                const boxY = this.margin.top + 60;
                const boxWidth = 240;
                const boxHeight = 30;
                
                // èƒŒæ™¯
                this.ctx.fillStyle = '#EF4444';
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                // æ–‡å­—
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 11px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                // 2ç§’å¾Œæ¸…é™¤è¨Šæ¯
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            drawFlashingHint(centerX, centerY) {
                // ä½¿ç”¨æ™‚é–“æˆ³å‰µé€ é–ƒçˆæ•ˆæœ
                const time = Date.now() / 1000;
                const alpha = 0.3 + 0.7 * Math.abs(Math.sin(time * 3)); // é–ƒçˆé »ç‡æ§åˆ¶
                
                this.ctx.save();
                this.ctx.globalAlpha = alpha;
                
                // ç¹ªè£½æœ‰åº•è‰²çš„æç¤ºæ¡†
                const hintWidth = 24;
                const hintHeight = 20;
                const hintX = centerX - hintWidth / 2;
                const hintY = centerY - hintHeight / 2;
                
                // èƒŒæ™¯é¡è‰²ï¼ˆé»ƒè‰²é–ƒçˆæç¤ºï¼‰
                this.ctx.fillStyle = '#FCD34D'; // é»ƒè‰²
                this.ctx.strokeStyle = '#F59E0B'; // æ·±é»ƒè‰²é‚Šæ¡†
                this.ctx.lineWidth = 2;
                
                this.ctx.beginPath();
                this.roundRect(hintX, hintY, hintWidth, hintHeight, 4);
                this.ctx.fill();
                this.ctx.stroke();
                
                // ç¹ªè£½è™›ç·šæˆ–æŒ‡ç¤ºç¬¦è™Ÿï¼ˆå¯é¸ï¼‰
                this.ctx.fillStyle = '#92400E'; // æ·±è‰²æ–‡å­—
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText('?', centerX, centerY);
                
                this.ctx.restore();
                
                // æŒçºŒé‡ç¹ªä»¥ä¿æŒé–ƒçˆæ•ˆæœ
                if (this.isDraggedToCanvas && !this.selectedComparison) {
                    setTimeout(() => {
                        this.drawChart();
                    }, 100); // æ¯100msé‡ç¹ªä¸€æ¬¡
                }
            }
            
            // æ–°å¢ï¼šç·´ç¿’é¡Œå¯ç”¨æ€§ç®¡ç†å‡½æ•¸
            updateQuizAvailability() {
                // ç·´ç¿’é¡Œå€åŸŸæ§åˆ¶
                const quizSection = document.getElementById('quizSection');
                const quizLockMessage = document.getElementById('quizLockMessage');
                const highElasticProgress = document.getElementById('highElasticProgress');
                const lowElasticProgress = document.getElementById('lowElasticProgress');
                
                // æ›´æ–°é€²åº¦é¡¯ç¤º
                if (this.completedTasks.high) {
                    highElasticProgress.innerHTML = 'âœ… å·²å®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹';
                    highElasticProgress.className = 'mt-1 text-xs text-green-600 dark:text-green-400';
                } else {
                    highElasticProgress.innerHTML = 'âŒ å°šæœªå®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹';
                    highElasticProgress.className = 'mt-1 text-xs text-red-600 dark:text-red-400';
                }
                
                if (this.completedTasks.low) {
                    lowElasticProgress.innerHTML = 'âœ… å·²å®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹';
                    lowElasticProgress.className = 'mt-1 text-xs text-green-600 dark:text-green-400';
                } else {
                    lowElasticProgress.innerHTML = 'âŒ å°šæœªå®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹';
                    lowElasticProgress.className = 'mt-1 text-xs text-red-600 dark:text-red-400';
                }
                
                // æª¢æŸ¥æ˜¯å¦å…©ç¨®å½ˆæ€§é¡å‹éƒ½å·²å®Œæˆ
                const allTasksCompleted = this.completedTasks.high && this.completedTasks.low;
                
                if (allTasksCompleted) {
                    // è§£é–ç·´ç¿’é¡Œ
                    quizLockMessage.classList.add('hidden');
                    
                    // å•Ÿç”¨æ‰€æœ‰ç·´ç¿’é¡Œ
                    const quizInputs = quizSection.querySelectorAll('input[type="radio"]');
                    quizInputs.forEach(input => {
                        input.disabled = false;
                        input.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                    });
                    
                    // å•Ÿç”¨é‡æ–°ä½œç­”æŒ‰éˆ•
                    const resetQuizBtn = document.getElementById('resetQuiz');
                    resetQuizBtn.disabled = false;
                    resetQuizBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    
                    // é¡¯ç¤ºè§£é–æˆåŠŸæ¶ˆæ¯
                    this.showQuizUnlockMessage();
                } else {
                    // ç·´ç¿’é¡Œä»ç„¶é–å®š
                    quizLockMessage.classList.remove('hidden');
                    
                    // ç¦ç”¨æ‰€æœ‰ç·´ç¿’é¡Œ
                    const quizInputs = quizSection.querySelectorAll('input[type="radio"]');
                    quizInputs.forEach(input => {
                        input.disabled = true;
                        input.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                    });
                    
                    // ç¦ç”¨é‡æ–°ä½œç­”æŒ‰éˆ•
                    const resetQuizBtn = document.getElementById('resetQuiz');
                    resetQuizBtn.disabled = true;
                    resetQuizBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }
            
            showQuizUnlockMessage() {
                // å‰µå»ºä¸€å€‹è‡¨æ™‚çš„æˆåŠŸæ¶ˆæ¯
                const quizSection = document.getElementById('quizSection');
                const unlockMessage = document.createElement('div');
                unlockMessage.className = 'mb-6 p-4 bg-green-100 dark:bg-green-900 rounded-lg border-l-4 border-green-500';
                unlockMessage.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2 text-green-800 dark:text-green-200">ğŸ‰ ç·´ç¿’é¡Œå·²è§£é–ï¼</h3>
                    <p class="text-green-700 dark:text-green-300">æ­å–œæ‚¨ï¼å·²æˆåŠŸå®Œæˆé«˜å½ˆæ€§å’Œä½å½ˆæ€§çš„æ‰€æœ‰ä»»å‹™ï¼Œç¾åœ¨å¯ä»¥é–‹å§‹ç·´ç¿’é¡Œäº†ã€‚</p>
                `;
                
                // æ’å…¥åˆ°é¡Œç›®å‰é¢
                const firstQuestion = quizSection.querySelector('.mb-6.p-4.bg-white');
                quizSection.insertBefore(unlockMessage, firstQuestion);
                
                // 5ç§’å¾Œè‡ªå‹•ç§»é™¤æ¶ˆæ¯
                setTimeout(() => {
                    if (unlockMessage.parentNode) {
                        unlockMessage.parentNode.removeChild(unlockMessage);
                    }
                }, 5000);
            }
        }
        
        // é¸æ“‡é¡Œç®¡ç†é¡
        class QuizManager {
            constructor() {
                this.questions = {
                    q1: { correct: 'price_up_quantity_down', answered: false },
                    q2: { correct: 'producer_revenue_decrease', answered: false },
                    q3: { correct: 'tax_amount', answered: false },
                    q4: { correct: 'depends_on_elasticity', answered: false },
                    q5: { correct: 'quantity_unchanged', answered: false }
                };
                this.score = 0;
                this.init();
            }
            
            init() {
                // åˆå§‹ç‹€æ…‹ï¼šç¦ç”¨æ‰€æœ‰ç·´ç¿’é¡Œ
                this.initializeQuizState();
                
                // ç‚ºæ¯å€‹é¡Œç›®æ·»åŠ äº‹ä»¶ç›£è½å™¨
                Object.keys(this.questions).forEach(questionId => {
                    const radios = document.querySelectorAll(`input[name="${questionId}"]`);
                    radios.forEach(radio => {
                        radio.addEventListener('change', () => {
                            this.checkAnswer(questionId, radio.value);
                        });
                    });
                });
                
                // é‡æ–°ä½œç­”æŒ‰éˆ•
                document.getElementById('resetQuiz').addEventListener('click', () => {
                    this.resetQuiz();
                });
            }
            
            initializeQuizState() {
                // åˆå§‹ç‹€æ…‹ï¼šç¦ç”¨æ‰€æœ‰ç·´ç¿’é¡Œ
                const quizSection = document.getElementById('quizSection');
                const quizInputs = quizSection.querySelectorAll('input[type="radio"]');
                
                quizInputs.forEach(input => {
                    input.disabled = true;
                    input.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                });
                
                // ç¦ç”¨é‡æ–°ä½œç­”æŒ‰éˆ•
                const resetQuizBtn = document.getElementById('resetQuiz');
                resetQuizBtn.disabled = true;
                resetQuizBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
            
            checkAnswer(questionId, selectedValue) {
                const question = this.questions[questionId];
                const feedbackDiv = document.getElementById(`feedback${questionId.slice(-1)}`);
                const isCorrect = selectedValue === question.correct;
                
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å›ç­”é€™å€‹å•é¡Œ
                if (!question.answered) {
                    question.answered = true;
                    if (isCorrect) {
                        this.score++;
                    }
                }
                
                // é¡¯ç¤ºåé¥‹
                feedbackDiv.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'dark:bg-green-900', 'dark:bg-red-900');
                
                if (isCorrect) {
                    feedbackDiv.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                    feedbackDiv.innerHTML = `<strong>âœ“ æ­£ç¢ºï¼</strong> ${this.getExplanation(questionId)}`;
                } else {
                    feedbackDiv.classList.add('bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200');
                    feedbackDiv.innerHTML = `<strong>âœ— éŒ¯èª¤ã€‚</strong> ${this.getExplanation(questionId)}`;
                }
                
                // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰é¡Œç›®éƒ½å·²å›ç­”
                this.updateTotalScore();
            }
            
            getExplanation(questionId) {
                const explanations = {
                    q1: 'å¾é‡ç¨…æœƒä½¿ä¾›çµ¦ç·šå‘ä¸Šç§»å‹•ï¼Œå°è‡´å¸‚å ´å‡è¡¡åƒ¹æ ¼ä¸Šå‡ã€å‡è¡¡æ•¸é‡ä¸‹é™ã€‚é€™æ˜¯å¾é‡ç¨…çš„åŸºæœ¬å¸‚å ´æ•ˆæœã€‚',
                    q2: 'é«˜å½ˆæ€§éœ€æ±‚æ„å‘³è‘—æ¶ˆè²»è€…å°åƒ¹æ ¼è®ŠåŒ–å¾ˆæ•æ„Ÿï¼Œåƒ¹æ ¼ä¸Šå‡æ™‚éœ€æ±‚é‡å¤§å¹…æ¸›å°‘ï¼Œå°è‡´ç”Ÿç”¢è€…ç¸½æ”¶å…¥ä¸‹é™ã€‚',
                    q3: 'å¾é‡ç¨…ä½¿ä¾›çµ¦ç·šå¹³è¡Œå‘ä¸Šç§»å‹•ï¼Œå…©æ¢ä¾›çµ¦ç·šä¹‹é–“çš„å‚ç›´è·é›¢æ­£å¥½ç­‰æ–¼æ¯å–®ä½å•†å“çš„ç¨…é¡å¤§å°ã€‚',
                    q4: 'æ¶ˆè²»è€…ç¸½æ”¯å‡º = åƒ¹æ ¼ Ã— æ•¸é‡ã€‚å¾é‡ç¨…å¾Œï¼Œåƒ¹æ ¼ä¸Šå‡ä½†æ•¸é‡ä¸‹é™ï¼Œæœ€çµ‚æ”¯å‡ºè®ŠåŒ–å–æ±ºæ–¼éœ€æ±‚å½ˆæ€§ï¼šé«˜å½ˆæ€§æ™‚æ•¸é‡é™å¹…å¤§ï¼Œæ”¯å‡ºæ¸›å°‘ï¼›ä½å½ˆæ€§æ™‚åƒ¹æ ¼å‡å¹…ç›¸å°æ›´å¤§ï¼Œæ”¯å‡ºå¯èƒ½å¢åŠ ã€‚',
                    q5: 'å®Œå…¨ç„¡å½ˆæ€§éœ€æ±‚æ„å‘³è‘—éœ€æ±‚å½ˆæ€§=0ï¼Œéœ€æ±‚æ›²ç·šç‚ºå‚ç›´ç·šã€‚ç„¡è«–åƒ¹æ ¼å¦‚ä½•è®ŠåŒ–ï¼Œæ¶ˆè²»è€…éœ€æ±‚é‡éƒ½ä¿æŒä¸è®Šï¼Œå› æ­¤äº¤æ˜“é‡ä¸æœƒå› å¾é‡ç¨…è€Œæ”¹è®Šã€‚'
                };
                return explanations[questionId];
            }
            
            updateTotalScore() {
                const answeredCount = Object.values(this.questions).filter(q => q.answered).length;
                const totalScoreDiv = document.getElementById('totalScore');
                
                if (answeredCount === 5) {
                    const percentage = Math.round((this.score / 5) * 100);
                    let grade = '';
                    let color = '';
                    
                    if (percentage >= 90) {
                        grade = 'å„ªç§€';
                        color = 'text-green-600 dark:text-green-400';
                    } else if (percentage >= 70) {
                        grade = 'è‰¯å¥½';
                        color = 'text-blue-600 dark:text-blue-400';
                    } else if (percentage >= 60) {
                        grade = 'åŠæ ¼';
                        color = 'text-yellow-600 dark:text-yellow-400';
                    } else {
                        grade = 'éœ€è¦åŠ å¼·';
                        color = 'text-red-600 dark:text-red-400';
                    }
                    
                    totalScoreDiv.innerHTML = `
                        <div class="text-xl font-bold ${color}">
                            ç¸½åˆ†ï¼š${this.score}/5 (${percentage}%) - ${grade}
                        </div>
                        <div class="text-sm mt-2 text-gray-600 dark:text-gray-400">
                            ${this.getScoreMessage(percentage)}
                        </div>
                    `;
                } else {
                    totalScoreDiv.innerHTML = `å·²å®Œæˆ ${answeredCount}/5 é¡Œï¼Œç›®å‰å¾—åˆ†ï¼š${this.score} åˆ†`;
                    totalScoreDiv.className = 'text-lg font-semibold text-blue-800 dark:text-blue-200';
                }
            }
            
            getScoreMessage(percentage) {
                if (percentage >= 90) {
                    return 'å¤ªæ£’äº†ï¼æ‚¨å°éœ€æ±‚åƒ¹æ ¼å½ˆæ€§çš„æ¦‚å¿µæŒæ¡å¾—éå¸¸å¥½ï¼';
                } else if (percentage >= 70) {
                    return 'å¾ˆå¥½ï¼æ‚¨å°å¤§éƒ¨åˆ†æ¦‚å¿µéƒ½ç†è§£æ­£ç¢ºï¼Œå¯ä»¥å†è¤‡ç¿’ä¸€ä¸‹éŒ¯èª¤çš„éƒ¨åˆ†ã€‚';
                } else if (percentage >= 60) {
                    return 'é‚„ä¸éŒ¯ï¼å»ºè­°æ‚¨é‡æ–°å›é¡§éœ€æ±‚å½ˆæ€§èˆ‡ç¸½æ”¶å…¥çš„é—œä¿‚ã€‚';
                } else {
                    return 'å»ºè­°æ‚¨é‡æ–°å­¸ç¿’éœ€æ±‚åƒ¹æ ¼å½ˆæ€§çš„åŸºæœ¬æ¦‚å¿µï¼Œç„¶å¾Œå†æ¬¡å˜—è©¦ã€‚';
                }
            }
            
            resetQuiz() {
                // é‡ç½®æ‰€æœ‰ç‹€æ…‹
                Object.keys(this.questions).forEach(questionId => {
                    this.questions[questionId].answered = false;
                    
                    // æ¸…é™¤é¸ä¸­ç‹€æ…‹
                    const radios = document.querySelectorAll(`input[name="${questionId}"]`);
                    radios.forEach(radio => {
                        radio.checked = false;
                    });
                    
                    // éš±è—åé¥‹
                    const feedbackDiv = document.getElementById(`feedback${questionId.slice(-1)}`);
                    feedbackDiv.classList.add('hidden');
                });
                
                this.score = 0;
                
                // é‡ç½®ç¸½åˆ†é¡¯ç¤º
                const totalScoreDiv = document.getElementById('totalScore');
                totalScoreDiv.textContent = 'å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå°‡é¡¯ç¤ºç¸½åˆ†';
                totalScoreDiv.className = 'text-lg font-semibold text-blue-800 dark:text-blue-200';
            }
        }
        
        // è¯­è¨€ç®¡ç†ç±»
        class LanguageManager {
            constructor() {
                this.currentLang = 'zh'; // é»˜è®¤ä¸­æ–‡
                this.translations = {
                    zh: {
                        mainTitle: 'éœ€æ±‚åƒ¹æ ¼å½ˆæ€§äº’å‹•æ•™å­¸',
                        task1Label: '<span class="text-red-600 dark:text-red-400">ä»»å‹™1</span>ï¼š<span class="text-red-600 dark:text-red-400">å¾é‡ç¨…</span>',
                        task2Label: '<span class="text-red-600 dark:text-red-400">ä»»å‹™2</span>ï¼š<span class="text-red-600 dark:text-red-400">éœ€æ±‚å½ˆæ€§é¡å‹</span>',
                        unitTaxText: 'å¾é‡ç¨…',
                        task2Hint: 'è«‹å…ˆå®Œæˆä»»å‹™1ï¼šé¸æ“‡å¾é‡ç¨…',
                        task3Label: '<span class="text-red-600 dark:text-red-400">ä»»å‹™3</span>ï¼š<span class="text-red-600 dark:text-red-400">æ‹–æ‹½åˆ°åœ–è¡¨</span>',
                        task4Label: '<span class="text-red-600 dark:text-red-400">ä»»å‹™4</span>ï¼š<span class="text-red-600 dark:text-red-400">æ‹–æ‹½åˆ°åœ–è¡¨</span>',
                        task5Label: '<span class="text-red-600 dark:text-red-400">ä»»å‹™5</span>ï¼š<span class="text-red-600 dark:text-red-400">æäº¤</span>',
                        resetLabel: '<span class="text-blue-600 dark:text-blue-400">é‡æ–°é–‹å§‹</span>',
                        highElasticText: 'é«˜å½ˆæ€§',
                        lowElasticText: 'ä½å½ˆæ€§',
                        benefitText: 'å¾—ç›Š',
                        lossText: 'æå¤±',
                        submitBtnText: 'æäº¤ç­”æ¡ˆ',
                        resetBtnText: 'é‡æ–°æ•´ç†',
                        quizTitle: 'éœ€æ±‚åƒ¹æ ¼å½ˆæ€§ç·´ç¿’é¡Œ',
                        quizLockTitle: 'ğŸ”’ ç·´ç¿’é¡Œå°šæœªè§£é–',
                        quizLockDesc: 'è«‹å…ˆå®Œæˆä»¥ä¸‹ä»»å‹™æ‰èƒ½é–‹å§‹ç·´ç¿’é¡Œï¼š',
                        highElasticTask: 'ä»»å‹™çµ„åˆ1ï¼šé«˜å½ˆæ€§æƒ…å¢ƒ',
                        lowElasticTask: 'ä»»å‹™çµ„åˆ2ï¼šä½å½ˆæ€§æƒ…å¢ƒ',
                        quizHint: 'ğŸ’¡ æç¤ºï¼šæ¯ç¨®å½ˆæ€§é¡å‹éƒ½éœ€è¦å®Œæˆä»»å‹™1-5çš„å®Œæ•´æµç¨‹ï¼ˆé¸æ“‡å¾é‡ç¨…â†’é¸æ“‡å½ˆæ€§é¡å‹â†’æ‹–æ‹½éœ€æ±‚ç·šâ†’æ‹–æ‹½å¾—ç›Š/æå¤±â†’æ‹–æ‹½æ¯”è¼ƒç¬¦è™Ÿâ†’æäº¤ç­”æ¡ˆï¼‰',
                        highElasticIncomplete: 'âŒ å°šæœªå®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        lowElasticIncomplete: 'âŒ å°šæœªå®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        highElasticComplete: 'âœ… å·²å®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        lowElasticComplete: 'âœ… å·²å®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        quizUnlockTitle: 'ğŸ‰ ç·´ç¿’é¡Œå·²è§£é–ï¼',
                        quizUnlockDesc: 'æ­å–œæ‚¨ï¼å·²æˆåŠŸå®Œæˆé«˜å½ˆæ€§å’Œä½å½ˆæ€§çš„æ‰€æœ‰ä»»å‹™ï¼Œç¾åœ¨å¯ä»¥é–‹å§‹ç·´ç¿’é¡Œäº†ã€‚',
                        totalScoreText: 'å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå°‡é¡¯ç¤ºç¸½åˆ†',
                        resetQuizText: 'é‡æ–°ä½œç­”'
                    },
                    en: {
                        mainTitle: 'Interactive Teaching of Price Elasticity of Demand',
                        task1Label: '<span class="text-red-600 dark:text-red-400">Task 1</span>: <span class="text-red-600 dark:text-red-400">Unit Tax</span>',
                        task2Label: '<span class="text-red-600 dark:text-red-400">Task 2</span>: <span class="text-red-600 dark:text-red-400">Elasticity Type</span>',
                        unitTaxText: 'Unit Tax',
                        task2Hint: 'Please complete Task 1 first: Select Unit Tax',
                        task3Label: '<span class="text-red-600 dark:text-red-400">Task 3</span>: <span class="text-red-600 dark:text-red-400">Drag to Chart</span>',
                        task4Label: '<span class="text-red-600 dark:text-red-400">Task 4</span>: <span class="text-red-600 dark:text-red-400">Drag to Chart</span>',
                        task5Label: '<span class="text-red-600 dark:text-red-400">Task 5</span>: <span class="text-red-600 dark:text-red-400">Submit</span>',
                        resetLabel: '<span class="text-blue-600 dark:text-blue-400">Reset</span>',
                        highElasticText: 'Elastic',
                        lowElasticText: 'Inelastic',
                        benefitText: 'Gain',
                        lossText: 'Loss',
                        submitBtnText: 'Submit Answer',
                        resetBtnText: 'Reset',
                        quizTitle: 'Price Elasticity of Demand Quiz',
                        quizLockTitle: 'ğŸ”’ Quiz Not Yet Unlocked',
                        quizLockDesc: 'Please complete the following tasks before starting the quiz:',
                        highElasticTask: 'Task Set 1: Elastic Scenario',
                        lowElasticTask: 'Task Set 2: Inelastic Scenario',
                        quizHint: 'ğŸ’¡ Hint: Each elasticity type requires completing the full Task 1-5 workflow (Select unit tax â†’ Select elasticity type â†’ Drag demand line â†’ Drag gain/loss â†’ Drag comparison symbol â†’ Submit answer)',
                        highElasticIncomplete: 'âŒ Elastic task workflow not completed',
                        lowElasticIncomplete: 'âŒ Inelastic task workflow not completed',
                        highElasticComplete: 'âœ… Elastic task workflow completed',
                        lowElasticComplete: 'âœ… Inelastic task workflow completed',
                        quizUnlockTitle: 'ğŸ‰ Quiz Unlocked!',
                        quizUnlockDesc: 'Congratulations! You have successfully completed all tasks for both elastic and inelastic scenarios. You can now start the quiz.',
                        totalScoreText: 'Total score will be displayed after completing all questions',
                        resetQuizText: 'Retake Quiz',
                        // Canvaså›¾è¡¨å†…æ–‡å­—ç¿»è¯‘
                        axisPrice: 'Price',
                        axisQuantity: 'Quantity',
                        gainText: 'Gain',
                        lossText: 'Loss',
                        hintChangeAngle: 'Change demand curve angle',
                        dropError: 'Please drag to P1-P2 or Q1-Q2 area',
                        comparisonError: 'Please drag to the comparison box at the top right of the chart',
                        p1p2Area: 'P1-P2 Area',
                        q1q2Area: 'Q1-Q2 Area',
                        // Quiz questions translations
                        q1Title: 'Question 1: Basic Effects of Unit Tax',
                        q1Question: 'When the government imposes a unit tax on a good, it will cause:',
                        q1Option1: 'Market price increases, transaction quantity decreases',
                        q1Option2: 'Market price decreases, transaction quantity increases', 
                        q1Option3: 'Both market price and quantity remain unchanged',
                        q2Title: 'Question 2: Price Elasticity of Demand and Producer Revenue',
                        q2Question: 'When demand for a good is <strong>elastic</strong>, producer total revenue will:',
                        q2Option1: 'Increase',
                        q2Option2: 'Decrease',
                        q2Option3: 'Remain unchanged',
                        q3Title: 'Question 3: Supply Curve Shift Magnitude',
                        q3Question: 'When the government implements a unit tax, the vertical distance between the two supply curves (S1 and S2) equals:',
                        q3Option1: 'The unit tax amount',
                        q3Option2: 'The change in market price',
                        q3Option3: 'The change in equilibrium quantity',
                        q4Title: 'Question 4: Consumer Total Expenditure',
                        q4Question: 'When the government implements a unit tax, consumer total expenditure will:',
                        q4Option1: 'Increase',
                        q4Option2: 'Decrease',
                        q4Option3: 'Depend on price elasticity of demand',
                        q5Title: 'Question 5: Perfectly Inelastic Demand',
                        q5Question: 'When the government implements a unit tax on good X, if consumer demand for it is <strong>perfectly inelastic</strong>, the transaction quantity will:',
                        q5Option1: 'Increase',
                        q5Option2: 'Decrease',
                        q5Option3: 'Remain unchanged'
                    }
                };
                this.init();
            }
            
            init() {
                // è®¾ç½®è¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
                document.getElementById('langZh').addEventListener('click', () => {
                    this.switchLanguage('zh');
                });
                
                document.getElementById('langEn').addEventListener('click', () => {
                    this.switchLanguage('en');
                });
            }
            
            switchLanguage(lang) {
                this.currentLang = lang;
                
                // æ›´æ–°è¯­è¨€æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('text-gray-600', 'dark:text-gray-400');
                });
                
                const activeBtn = lang === 'zh' ? document.getElementById('langZh') : document.getElementById('langEn');
                activeBtn.classList.add('bg-primary', 'text-white');
                activeBtn.classList.remove('text-gray-600', 'dark:text-gray-400');
                
                // æ›´æ–°é¡µé¢å†…å®¹
                this.updateContent();
                
                // è§¦å‘Canvasé‡æ–°ç»˜åˆ¶ä»¥æ›´æ–°è¯­è¨€
                if (window.simulator) {
                    window.simulator.drawChart();
                }
            }
            
            updateContent() {
                const trans = this.translations[this.currentLang];
                
                // æ›´æ–°åŸºæœ¬å…ƒç´ 
                document.getElementById('mainTitle').textContent = trans.mainTitle;
                document.getElementById('task1Label').innerHTML = trans.task1Label;
                document.getElementById('task2Label').innerHTML = trans.task2Label;
                document.getElementById('task3Label').innerHTML = trans.task3Label;
                document.getElementById('task4Label').innerHTML = trans.task4Label;
                document.getElementById('task5Label').innerHTML = trans.task5Label;
                document.getElementById('resetLabel').innerHTML = trans.resetLabel;
                
                document.getElementById('unitTaxText').textContent = trans.unitTaxText;
                document.getElementById('highElasticText').textContent = trans.highElasticText;
                document.getElementById('lowElasticText').textContent = trans.lowElasticText;
                document.getElementById('benefitText').textContent = trans.benefitText;
                document.getElementById('lossText').textContent = trans.lossText;
                document.getElementById('submitBtnText').textContent = trans.submitBtnText;
                document.getElementById('resetBtnText').textContent = trans.resetBtnText;
                // task2Hint å…ƒç´ å·²è¢«åˆ é™¤ï¼Œè·³è¿‡æ›´æ–°
                
                // æ›´æ–°ç»ƒä¹ é¢˜éƒ¨åˆ†
                const quizElements = document.querySelectorAll('#quizSection h2')[0];
                if (quizElements) quizElements.textContent = trans.quizTitle;
                
                const quizLockTitle = document.querySelector('#quizLockMessage h3');
                if (quizLockTitle) quizLockTitle.textContent = trans.quizLockTitle;
                
                const quizLockDesc = document.querySelector('#quizLockMessage p');
                if (quizLockDesc) quizLockDesc.textContent = trans.quizLockDesc;
                
                const highTaskDiv = document.querySelector('#quizLockMessage .font-medium');
                if (highTaskDiv) highTaskDiv.textContent = trans.highElasticTask;
                
                const lowTaskDiv = document.querySelectorAll('#quizLockMessage .font-medium')[1];
                if (lowTaskDiv) lowTaskDiv.textContent = trans.lowElasticTask;
                
                const hintP = document.querySelector('#quizLockMessage .mt-3');
                if (hintP) hintP.textContent = trans.quizHint;
                
                const totalScore = document.getElementById('totalScore');
                if (totalScore && (totalScore.textContent.includes('å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå°‡é¡¯ç¤ºç¸½åˆ†') || totalScore.textContent.includes('Total score will be displayed'))) {
                    totalScore.textContent = trans.totalScoreText;
                }
                
                document.getElementById('resetQuiz').textContent = trans.resetQuizText;
                
                // æ›´æ–°è¿›åº¦æ˜¾ç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                const highProgress = document.getElementById('highElasticProgress');
                const lowProgress = document.getElementById('lowElasticProgress');
                
                if (highProgress) {
                    if (highProgress.textContent.includes('âŒ')) {
                        highProgress.textContent = trans.highElasticIncomplete;
                    } else if (highProgress.textContent.includes('âœ…')) {
                        highProgress.textContent = trans.highElasticComplete;
                    }
                }
                
                if (lowProgress) {
                    if (lowProgress.textContent.includes('âŒ')) {
                        lowProgress.textContent = trans.lowElasticIncomplete;
                    } else if (lowProgress.textContent.includes('âœ…')) {
                        lowProgress.textContent = trans.lowElasticComplete;
                    }
                }
                
                // æ›´æ–°ç»ƒä¹ é¢˜å†…å®¹
                this.updateQuizContent(trans);
            }
            
            getText(key) {
                return this.translations[this.currentLang][key] || key;
            }
            
            updateQuizContent(trans) {
                // å¦‚æœå½“å‰ä¸æ˜¯è‹±æ–‡ï¼Œè·³è¿‡æ›´æ–°
                if (this.currentLang !== 'en') return;
                
                // ä½¿ç”¨æ›´ç²¾ç¡®çš„é€‰æ‹©å™¨æ¥æ›´æ–°é¢˜ç›®æ ‡é¢˜å’Œå†…å®¹
                // åªé€‰æ‹©ç»ƒä¹ é¢˜çš„divï¼ˆbg-whiteï¼‰ï¼Œæ’é™¤è§£é”æç¤ºdivï¼ˆbg-yellow-100ï¼‰
                const questionElements = document.querySelectorAll('#quizSection .mb-6.bg-white');
                
                // æ›´æ–°é¢˜ç›®1
                if (questionElements[0]) {
                    const q1Title = questionElements[0].querySelector('h3');
                    const q1Question = questionElements[0].querySelector('p');
                    const q1Options = questionElements[0].querySelectorAll('input[type="radio"] + span');
                    
                    if (q1Title) q1Title.textContent = trans.q1Title;
                    if (q1Question) q1Question.innerHTML = trans.q1Question;
                    if (q1Options.length >= 3) {
                        q1Options[0].textContent = trans.q1Option1;
                        q1Options[1].textContent = trans.q1Option2;
                        q1Options[2].textContent = trans.q1Option3;
                    }
                }
                
                // æ›´æ–°é¢˜ç›®2
                if (questionElements[1]) {
                    const q2Title = questionElements[1].querySelector('h3');
                    const q2Question = questionElements[1].querySelector('p');
                    const q2Options = questionElements[1].querySelectorAll('input[type="radio"] + span');
                    
                    if (q2Title) q2Title.textContent = trans.q2Title;
                    if (q2Question) q2Question.innerHTML = trans.q2Question;
                    if (q2Options.length >= 3) {
                        q2Options[0].textContent = trans.q2Option1;
                        q2Options[1].textContent = trans.q2Option2;
                        q2Options[2].textContent = trans.q2Option3;
                    }
                }
                
                // æ›´æ–°é¢˜ç›®3
                if (questionElements[2]) {
                    const q3Title = questionElements[2].querySelector('h3');
                    const q3Question = questionElements[2].querySelector('p');
                    const q3Options = questionElements[2].querySelectorAll('input[type="radio"] + span');
                    
                    if (q3Title) q3Title.textContent = trans.q3Title;
                    if (q3Question) q3Question.innerHTML = trans.q3Question;
                    if (q3Options.length >= 3) {
                        q3Options[0].textContent = trans.q3Option1;
                        q3Options[1].textContent = trans.q3Option2;
                        q3Options[2].textContent = trans.q3Option3;
                    }
                }
                
                // æ›´æ–°é¢˜ç›®4
                if (questionElements[3]) {
                    const q4Title = questionElements[3].querySelector('h3');
                    const q4Question = questionElements[3].querySelector('p');
                    const q4Options = questionElements[3].querySelectorAll('input[type="radio"] + span');
                    
                    if (q4Title) q4Title.textContent = trans.q4Title;
                    if (q4Question) q4Question.innerHTML = trans.q4Question;
                    if (q4Options.length >= 3) {
                        q4Options[0].textContent = trans.q4Option1;
                        q4Options[1].textContent = trans.q4Option2;
                        q4Options[2].textContent = trans.q4Option3;
                    }
                }
                
                // æ›´æ–°é¢˜ç›®5
                if (questionElements[4]) {
                    const q5Title = questionElements[4].querySelector('h3');
                    const q5Question = questionElements[4].querySelector('p');
                    const q5Options = questionElements[4].querySelectorAll('input[type="radio"] + span');
                    
                    if (q5Title) q5Title.textContent = trans.q5Title;
                    if (q5Question) q5Question.innerHTML = trans.q5Question;
                    if (q5Options.length >= 3) {
                        q5Options[0].textContent = trans.q5Option1;
                        q5Options[1].textContent = trans.q5Option2;
                        q5Options[2].textContent = trans.q5Option3;
                    }
                }
            }
        }
        
        // å…¨å±€è¯­è¨€ç®¡ç†å™¨å®ä¾‹
        let languageManager;
        
        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        window.addEventListener('load', () => {
            languageManager = new LanguageManager();
            window.simulator = new ElasticitySimulator('economicChart');
            new QuizManager();
        });
    </script>
</body>
</html>
